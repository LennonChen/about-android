<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
    <title>Android系统镜像文件的打包过程分析 - 老罗的Android之旅
        - 博客频道 - CSDN.NET</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="在前面一篇文章中，我们分析了Android模块的编译过程。当Android系统的所有模块都编译好之后，我们就可以对编译出来的模块文件进行打包了。打包结果是获得一系列的镜像文件，例如system.img、boot.img、ramdisk.img、userdata.img和recovery.img等。这些镜像文件最终可以烧录到手机上运行。在本文中，我们就详细分析Android系统的镜像文件的打包过程。">
    <script src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ga.js" async="" type="text/javascript"></script><script src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ad.js"></script>
        <!--new top-->
       
        <link rel="stylesheet" href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/index.css">
        <!--new top-->

    <link rel="Stylesheet" type="text/css" href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/style.css">
    <link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://blog.csdn.net/Luoshengyang/rss/list">
    <link rel="shortcut icon" href="http://csdnimg.cn/public/favicon.ico">
    <link type="text/css" rel="stylesheet" href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/default.css">
 

<link rel="stylesheet" href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/font-awesome.css"><link type="text/css" rel="stylesheet" href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/bdsstyle.css"><script src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/tracking.js" charset="utf-8" type="text/javascript"></script><script src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/main.js" charset="utf-8" type="text/javascript"></script><link href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/style_002.css" rel="stylesheet" type="text/css"><script src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/logger.js"></script></head>
<body><div style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;" id="BAIDU_DUP_fp_wrapper"><iframe style="width: 0px; height: 0px; visibility: hidden; display: none;" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/o.html" id="BAIDU_DUP_fp_iframe"></iframe></div><iframe style="display: none;" frameborder="0"></iframe><div style="display: block;" id="bdshare_s"><iframe id="bdsIfr" style="position:absolute;display:none;z-index:9999;" frameborder="0"></iframe><div style="display: none;" id="bdshare_l"><div id="bdshare_l_c"><h6>分享到</h6><ul><li><a href="#" class="bds_mshare mshare">一键分享</a></li><li><a href="#" class="bds_qzone qqkj">QQ空间</a></li><li><a href="#" class="bds_tsina xlwb">新浪微博</a></li><li><a href="#" class="bds_bdysc bdysc">百度云收藏</a></li><li><a href="#" class="bds_renren rrw">人人网</a></li><li><a href="#" class="bds_tqq txwb">腾讯微博</a></li><li><a href="#" class="bds_bdxc bdxc">百度相册</a></li><li><a href="#" class="bds_kaixin001 kxw">开心网</a></li><li><a href="#" class="bds_tqf txpy">腾讯朋友</a></li><li><a href="#" class="bds_tieba bdtb">百度贴吧</a></li><li><a href="#" class="bds_douban db">豆瓣网</a></li><li><a href="#" class="bds_tsohu shwb">搜狐微博</a></li><li><a href="#" class="bds_bdhome bdhome">百度新首页</a></li><li><a href="#" class="bds_sqq sqq">QQ好友</a></li><li><a href="#" class="bds_thx thx">和讯微博</a></li><li><a href="#" class="bds_more">更多...</a></li></ul><p><a href="#" class="goWebsite">百度分享</a></p></div></div></div>
    
   
      <!--new top-->
    <script id="toolbar-tpl-scriptId" fixed="true" prod="blog" skin="black" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/html.js" type="text/javascript"></script><div class="csdn-toolbar csdn-toolbar-skin-black ">        <div class="container row center-block ">          <div class="col-md-3 pull-left logo clearfix"><a href="http://www.csdn.net/?ref=toolbar" title="CSDN首页" target="_blank" class="icon"></a><a title="频道首页" href="http://blog.csdn.net/?ref=toolbar_logo" target="_blank" class="img blog-icon"></a></div>          <div class="pull-right login-wrap unlogin">            <ul class="btns">              <li class="loginlink"><a href="https://passport.csdn.net/account/login?ref=toolbar" target="_top">登录&nbsp;</a>|<a target="_top" href="https://passport.csdn.net/account/register?ref=toolbar">&nbsp;注册</a></li>              <li class="search">                <div class="icon on-search-icon">                  <div class="wrap">                    <div class="curr-icon-wrap">                      <div class="curr-icon"></div>                    </div>                    <form action="http://so.csdn.net/search" method="get" target="_blank">                      <input value="toolbar" name="ref" accesskey="2" type="hidden">                      <div class="border">                        <input placeholder="搜索" name="q" accesskey="2" type="text"><span class="icon-enter-sm"></span>                      </div>                    </form>                  </div>                </div>              </li>              <li class="favor">                <div class="icon on-favor-icon">                  <div class="wrap">                    <div class="curr-icon-wrap">                      <div class="curr-icon"></div>                    </div>                    <div style="display:none;" class="favor-success"><span class="msg">收藏成功</span>                      <div class="btns"><span class="btn btn-primary ok">确定</span></div>                    </div>                    <div style="display:none;" class="favor-failed"><span class="icon-danger-lg"></span><span class="msg">收藏失败，请重新收藏</span>                      <div class="btns"><span class="btn btn-primary ok">确定</span></div>                    </div>                    <form role="form" class="form-horizontal favor-form">                      <div class="form-group">                        <div class="clearfix">                          <label for="input-title" class="col-sm-2 control-label">标题</label>                          <div class="col-sm-10">                            <input value="Android系统镜像文件的打包过程分析 - 老罗的Android之旅 - 博客频道 - CSDN.NET" id="inputTitle" placeholder="" class="title form-control" type="text">                          </div>                        </div>                        <div class="alert alert-danger"><strong></strong>标题不能为空</div>                      </div>                      <div class="form-group">                        <label for="input-url" class="col-sm-2 control-label">网址</label>                        <div class="col-sm-10">                          <input value="http://blog.csdn.net/luoshengyang/article/details/20501657" id="input-url" placeholder="" class="url form-control" type="text">                        </div>                      </div>                      <div class="form-group">                        <label for="input-tag" class="col-sm-2 tag control-label">标签</label>                        <div class="col-sm-10">                          <input id="input-tag" class="form-control tag" type="text">                        </div>                      </div>                      <div class="form-group">                        <label for="input-description" class="description col-sm-2 control-label">摘要</label>                        <div class="col-sm-10">                          <textarea id="input-description" class="form-control description"></textarea>                        </div>                      </div>                      <div class="form-group">                        <div class="col-sm-offset-2 col-sm-10 ft">                          <div class="col-sm-4 pull-left">                            <div class="checkbox">                              <label>                                <input name="share" checked="checked" class="share" type="checkbox">公开                              </label>                            </div>                          </div>                          <div class="col-sm-8 pull-right favor-btns">                            <button type="button" class="cancel btn btn-default">取消</button>                            <button type="submit" class="submit btn btn-primary">收藏</button>                          </div>                        </div>                      </div>                    </form>                  </div>                </div>              </li>              <li class="notify">                <div style="display:none" class="number"></div>                <div style="display:none" class="icon-hasnotes-sm"></div>                <div id="header_notice_num"></div>                <div class="icon on-notify-icon">                  <div class="wrap">                    <div class="curr-icon-wrap">                      <div class="curr-icon"></div>                    </div>                    <div id="note1" class="csdn_note">                      <div class="box"></div>                    <iframe src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/a.html" allowtransparency="true" style="z-index:-1;position:absolute;top:0;left:0;width:100%;height:100%;background:transparent" frameborder="0"></iframe></div>                  </div>                </div>              </li>              <li class="ugc">                <div class="icon on-ugc-icon">                  <div class="wrap clearfix">                    <div class="curr-icon-wrap">                      <div class="curr-icon"></div>                    </div>                    <dl>                      <dt><a href="http://geek.csdn.net/news/expert?ref=toolbar" target="_blank" class="p-news clearfix"><em class="icon"></em><span>分享资讯</span></a></dt>                      <dt><a href="http://share.csdn.net/slides/new?ref=toolbar" target="_blank" class="p-doc clearfix"><em class="icon"></em><span>传PPT/文档</span></a></dt>                      <dt><a href="http://bbs.csdn.net/topics/new?ref=toolbar" target="_blank" class="p-ask clearfix"><em class="icon"></em><span>提问题</span></a></dt>                      <dt><a href="http://write.blog.csdn.net/postedit?ref=toolbar" target="_blank" class="p-blog clearfix"><em class="icon"></em><span>写博客</span></a></dt>                      <dt><a href="http://u.download.csdn.net/upload?ref=toolbar" target="_blank" class="p-src clearfix"><em class="icon"></em><span>传资源</span></a></dt>                      <dt><a href="https://code.csdn.net/projects/new?ref=toolbar" target="_blank" class="c-obj clearfix"><em class="icon"></em><span>创建项目</span></a></dt>                      <dt><a href="https://code.csdn.net/snippets/new?ref=toolbar" target="_blank" class="c-code clearfix"><em class="icon"></em><span>创建代码片</span></a></dt>                    </dl>                  </div>                </div>              </li>              <li class="profile">                <div class="icon on-profile-icon"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/100x100.jpg" class="curr-icon-img">                  <div class="wrap clearfix">                    <div class="curr-icon-wrap">                      <div class="curr-icon"></div>                    </div>                    <div class="bd">                      <dl class="clearfix">                        <dt class="pull-left img"><a target="_blank" href="http://my.csdn.net/?ref=toolbar" class="avatar"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/100x100.jpg"></a></dt>                        <dd class="info"><a target="_blank" href="http://my.csdn.net/?ref=toolbar" class="nickname"></a><a class="set-nick" href="https://passport.csdn.net/account/profile">设置昵称<span class="write-icon"></span></a><span class="dec"><a class="fill-dec" href="http://my.csdn.net/" target="_blank">编辑自我介绍，让更多人了解你<span class="write-icon"></span></a></span></dd>                      </dl>                    </div>                    <div class="ft clearfix"><a target="_blank" href="http://my.csdn.net/my/account/changepwd?ref=toolbar" class="pull-left"><span class="icon-cog"></span>帐号设置</a><a href="https://passport.csdn.net/account/logout?ref=toolbar" target="_top" class="pull-right "><span class="icon-signout"></span><span class="out">退出</span></a></div>                  </div>                </div>              </li>              <li class="apps">                <div class="icon on-apps-icon">                  <div class="wrap clearfix">                    <div class="curr-icon-wrap">                      <div class="curr-icon"></div>                    </div>                  <div class="detail">                    <dl>                      <dt>                        <h5>社区</h5>                      </dt>                      <dd> <a href="http://blog.csdn.net/?ref=toolbar" target="_blank">博客</a></dd>                      <dd> <a href="http://bbs.csdn.net/?ref=toolbar" target="_blank">论坛</a></dd>                      <dd> <a href="http://download.csdn.net/?ref=toolbar" target="_blank">下载</a></dd>                      <dd><a href="http://share.csdn.net/?ref=toolbar" target="_blank">Share</a></dd>                      <dd><a href="http://geek.csdn.net/?ref=toolbar" target="_blank">极客头条</a></dd>                    </dl>                  </div>                  <div class="detail">                    <dl>                      <dt>                        <h5>服务</h5>                      </dt>                      <dd> <a href="https://code.csdn.net/?ref=toolbar" target="_blank">CODE</a></dd>                      <dd> <a href="http://hero.csdn.net/?ref=toolbar" target="_blank">英雄会</a></dd>                      <dd> <a href="http://huiyi.csdn.net/meeting?ref=toolbar" target="_blank">会议</a></dd>                      <dd> <a href="http://www.csto.com/?ref=toolbar" target="_blank">CSTO</a></dd>                    </dl>                  </div>                  <div class="detail last">                    <dl>                      <dt>                        <h5>俱乐部</h5>                      </dt>                      <dd> <a href="http://student.csdn.net/?ref=toolbar" target="_blank">高校俱乐部</a></dd>                      <dd> <a href="http://club.csdn.net/cto?ref=toolbar" target="_blank">CTO俱乐部</a></dd>                    </dl>                  </div>                </div>              </div>            </li>            </ul>          </div>        </div>    </div>
     <!--new top-->
    <div id="container">
        <div id="header">
    <div class="header">
        <div id="blog_title">
            <h2>
                <a href="http://blog.csdn.net/luoshengyang">老罗的Android之旅</a></h2>
            <h3>爱生活，爱Android</h3>
            <div class="clear">
            </div>
        </div>
        <div class="clear">
        </div>
    </div>
</div>
<div id="navigator">
    <div class="navigator_bg">
    </div>
    <div class="navigator">
        <ul>
                <li id="btnContents"><a href="http://blog.csdn.net/luoshengyang?viewmode=contents"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_mulu'])">
                    <img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ico_list.gif">目录视图</span></a></li>
                <li id="btnView"><a href="http://blog.csdn.net/luoshengyang?viewmode=list"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_zhaiyao'])">
                    <img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ico_summary.gif">摘要视图</span></a></li>
                <li id="btnRss"><a href="http://blog.csdn.net/luoshengyang/rss/list"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_RSS'])">
                    <img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ico_rss.gif">订阅</span></a></li>
</ul>
    </div>
</div>
<script type="text/javascript">
    var username = "Luoshengyang";
    var _blogger = username;
    var blog_address = "http://blog.csdn.net/luoshengyang";
    var static_host = "http://static.blog.csdn.net";
    var currentUserName = "";
</script>

        <div id="body">
            <div id="main">
                <div class="main">
<div class="notice tracking-ad" data-mod="popu_3"> 

<a href="http://huiyi.csdn.net/meeting/info/858/biz" target="_blank">
<font color="red">云计算大会门票限量申请

</font></a>
&nbsp;&nbsp;&nbsp;&nbsp;

<a href="http://www.csdn.net/article/2014-04-28/2819531" target="_blank">
<font color="blue">【社区之星】孔德芳：如何才能提高Java Web性能？
</font></a>

</div>                    <link href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/comment1.css" type="text/css" rel="stylesheet">
<link href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/style1.css" type="text/css" rel="stylesheet">
<div id="article_details" class="details">
    <div class="article_title">   
         <span class="ico ico_type_Original"></span>


    <h1>
        <span class="link_title"><a href="http://blog.csdn.net/luoshengyang/article/details/20501657">
        Android系统镜像文件的打包过程分析
        </a></span>
    </h1>
</div>

    <div class="article_manage">
        <span class="link_categories">
        分类：
            <a href="http://blog.csdn.net/Luoshengyang/article/category/838604" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_fenlei']);">Android</a> 
        </span>
    <span class="link_postdate">2014-04-14 01:01</span>
    <span class="link_view" title="阅读次数">4103人阅读</span>
    <span class="link_comments" title="评论次数"><a href="#comments" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_pinglun'])">评论</a>(13)</span>
    <span class="link_collect"><a href="javascript:void(0);" onclick="javascript:_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shoucang']);collectArticle('Android系统镜像文件的打包过程分析','20501657');return false;" title="收藏">收藏</a></span>
    <span class="link_report"><a href="#report" onclick="javascript:_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_jubao']);report(20501657,2);return false;" title="举报">举报</a></span>
    
</div>
<div class="tag2box"><a href="http://www.csdn.net/tag/Android" target="_blank" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_tag']);">Android</a><a href="http://www.csdn.net/tag/system.img" target="_blank" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_tag']);">system.img</a><a href="http://www.csdn.net/tag/boot.img" target="_blank" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_tag']);">boot.img</a><a href="http://www.csdn.net/tag/recovery.img" target="_blank" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_tag']);">recovery.img</a><a href="http://www.csdn.net/tag/ramdisk.img" target="_blank" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_tag']);">ramdisk.img</a></div>

    
<div id="article_content" class="article_content">
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
在前面一篇文章中，我们分析了Android模块的编译过程。当Android系统的所有模块都编译好之后，我们就可以对编译出来的模块文件进行打包了。
打包结果是获得一系列的镜像文件，例如system.img、boot.img、ramdisk.img、userdata.img和
recovery.img等。这些镜像文件最终可以烧录到手机上运行。在本文中，我们就详细分析Android系统的镜像文件的打包过程。</p><p align="center"><span style="font-size:14px;color:#CC0000;">老罗的新浪微博：<a target="_blank" href="http://weibo.com/shengyangluo">http://weibo.com/shengyangluo</a>，欢迎关注！</span><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Android系统镜像文件的打包工作同样是由Android编译系统来完成的，如图1所示：</p><p align="center"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/20140305012118562.png" alt="" width="614"></p><p align="center">图1 Android系统镜像文件的打包过程</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 从前面<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/18928789">Android编译系统环境初始化过程分析</a>和<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/19023609">Android源代码编译命令m/mm/mmm/make分析</a>这
两篇文章可以知道，Android编译系统在初始化的过程中，会通过根目录下的Makefile脚本加载build/core/main.mk脚本，接着
build/core/main.mk脚本又会加载build/core/Makefile脚本，而Android系统镜像文件就是由build
/core/Makefile脚本负责打包生成的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在build/core/main.mk文件中，与Android系统镜像文件打包过程相关的内容如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 1167px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_1" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_1" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>......&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>ifdef&nbsp;FULL_BUILD&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;#&nbsp;The&nbsp;base&nbsp;list&nbsp;of&nbsp;modules&nbsp;to&nbsp;build&nbsp;for&nbsp;this&nbsp;product&nbsp;is&nbsp;specified&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;#&nbsp;by&nbsp;the&nbsp;appropriate&nbsp;product&nbsp;definition&nbsp;file,&nbsp;which&nbsp;was&nbsp;included&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;#&nbsp;by&nbsp;product_config.make.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;product_MODULES&nbsp;:=&nbsp;$(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;#&nbsp;Filter&nbsp;out&nbsp;the&nbsp;overridden&nbsp;packages&nbsp;before&nbsp;doing&nbsp;expansion&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;product_MODULES&nbsp;:=&nbsp;$(filter-out&nbsp;$(foreach&nbsp;p,&nbsp;$(product_MODULES),&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(PACKAGES.$(p).OVERRIDES)),&nbsp;$(product_MODULES))&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;$(call&nbsp;expand-required-modules,product_MODULES,$(product_MODULES))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;product_FILES&nbsp;:=&nbsp;$(call&nbsp;module-installed-files,&nbsp;$(product_MODULES))&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;......&nbsp;&nbsp;</span></li><li class=""><span>else&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;#&nbsp;We're&nbsp;not&nbsp;doing&nbsp;a&nbsp;full&nbsp;build,&nbsp;and&nbsp;are&nbsp;probably&nbsp;only&nbsp;including&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;#&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;module&nbsp;makefiles.&nbsp;&nbsp;Don't&nbsp;try&nbsp;to&nbsp;build&nbsp;any&nbsp;modules&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;#&nbsp;requested&nbsp;by&nbsp;the&nbsp;product,&nbsp;because&nbsp;we&nbsp;probably&nbsp;won't&nbsp;have&nbsp;rules&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;#&nbsp;to&nbsp;build&nbsp;them.&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;product_FILES&nbsp;:=&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>modules_to_install&nbsp;:=&nbsp;$(sort&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_DEFAULT_INSTALLED_MODULES)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(product_FILES)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(foreach&nbsp;tag,$(tags_to_install),$($(tag)_MODULES))&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;get-tagged-modules,&nbsp;shell_$(TARGET_SHELL))&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(CUSTOM_MODULES)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Some&nbsp;packages&nbsp;may&nbsp;override&nbsp;others&nbsp;using&nbsp;LOCAL_OVERRIDES_PACKAGES.&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;Filter&nbsp;out&nbsp;(do&nbsp;not&nbsp;install)&nbsp;any&nbsp;overridden&nbsp;packages.&nbsp;&nbsp;</span></li><li class="alt"><span>overridden_packages&nbsp;:=&nbsp;$(call&nbsp;get-package-overrides,$(modules_to_install))&nbsp;&nbsp;</span></li><li class=""><span>ifdef&nbsp;overridden_packages&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;&nbsp;old_modules_to_install&nbsp;:=&nbsp;$(modules_to_install)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;modules_to_install&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(filter-out&nbsp;$(foreach&nbsp;p,$(overridden_packages),$(p)&nbsp;%/$(p).apk),&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(modules_to_install))&nbsp;&nbsp;</span></li><li class="alt"><span>endif&nbsp;&nbsp;</span></li><li class=""><span>......&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;Install&nbsp;all&nbsp;of&nbsp;the&nbsp;host&nbsp;modules&nbsp;&nbsp;</span></li><li class="alt"><span>modules_to_install&nbsp;+=&nbsp;$(sort&nbsp;$(modules_to_install)&nbsp;$(ALL_HOST_INSTALLED_FILES))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;build/core/Makefile&nbsp;contains&nbsp;extra&nbsp;stuff&nbsp;that&nbsp;we&nbsp;don't&nbsp;want&nbsp;to&nbsp;pollute&nbsp;this&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;top-level&nbsp;makefile&nbsp;with.&nbsp;&nbsp;It&nbsp;expects&nbsp;that&nbsp;ALL_DEFAULT_INSTALLED_MODULES&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;contains&nbsp;everything&nbsp;that's&nbsp;built&nbsp;during&nbsp;the&nbsp;current&nbsp;make,&nbsp;but&nbsp;it&nbsp;also&nbsp;further&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;extends&nbsp;ALL_DEFAULT_INSTALLED_MODULES.&nbsp;&nbsp;</span></li><li class="alt"><span>ALL_DEFAULT_INSTALLED_MODULES&nbsp;:=&nbsp;$(modules_to_install)&nbsp;&nbsp;</span></li><li class=""><span>include&nbsp;$(BUILD_SYSTEM)/Makefile&nbsp;&nbsp;</span></li><li class="alt"><span>modules_to_install&nbsp;:=&nbsp;$(sort&nbsp;$(ALL_DEFAULT_INSTALLED_MODULES))&nbsp;&nbsp;</span></li><li class=""><span>ALL_DEFAULT_INSTALLED_MODULES&nbsp;:=&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>.PHONY:&nbsp;ramdisk&nbsp;&nbsp;</span></li><li class=""><span>ramdisk:&nbsp;$(INSTALLED_RAMDISK_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>.PHONY:&nbsp;userdataimage&nbsp;&nbsp;</span></li><li class=""><span>userdataimage:&nbsp;$(INSTALLED_USERDATAIMAGE_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>.PHONY:&nbsp;bootimage&nbsp;&nbsp;</span></li><li class=""><span>bootimage:&nbsp;$(INSTALLED_BOOTIMAGE_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>......&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">......

ifdef FULL_BUILD
  # The base list of modules to build for this product is specified
  # by the appropriate product definition file, which was included
  # by product_config.make.
  product_MODULES := $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES)
  # Filter out the overridden packages before doing expansion
  product_MODULES := $(filter-out $(foreach p, $(product_MODULES), \
      $(PACKAGES.$(p).OVERRIDES)), $(product_MODULES))
  $(call expand-required-modules,product_MODULES,$(product_MODULES))
  product_FILES := $(call module-installed-files, $(product_MODULES))
  ......
else
  # We're not doing a full build, and are probably only including
  # a subset of the module makefiles.  Don't try to build any modules
  # requested by the product, because we probably won't have rules
  # to build them.
  product_FILES :=
endif
......

modules_to_install := $(sort \
    $(ALL_DEFAULT_INSTALLED_MODULES) \
    $(product_FILES) \
    $(foreach tag,$(tags_to_install),$($(tag)_MODULES)) \
    $(call get-tagged-modules, shell_$(TARGET_SHELL)) \
    $(CUSTOM_MODULES) \
  )

# Some packages may override others using LOCAL_OVERRIDES_PACKAGES.
# Filter out (do not install) any overridden packages.
overridden_packages := $(call get-package-overrides,$(modules_to_install))
ifdef overridden_packages
#  old_modules_to_install := $(modules_to_install)
  modules_to_install := \
      $(filter-out $(foreach p,$(overridden_packages),$(p) %/$(p).apk), \
          $(modules_to_install))
endif
......

# Install all of the host modules
modules_to_install += $(sort $(modules_to_install) $(ALL_HOST_INSTALLED_FILES))

# build/core/Makefile contains extra stuff that we don't want to pollute this
# top-level makefile with.  It expects that ALL_DEFAULT_INSTALLED_MODULES
# contains everything that's built during the current make, but it also further
# extends ALL_DEFAULT_INSTALLED_MODULES.
ALL_DEFAULT_INSTALLED_MODULES := $(modules_to_install)
include $(BUILD_SYSTEM)/Makefile
modules_to_install := $(sort $(ALL_DEFAULT_INSTALLED_MODULES))
ALL_DEFAULT_INSTALLED_MODULES :=
......

.PHONY: ramdisk
ramdisk: $(INSTALLED_RAMDISK_TARGET)
......

.PHONY: userdataimage
userdataimage: $(INSTALLED_USERDATAIMAGE_TARGET)
......

.PHONY: bootimage
bootimage: $(INSTALLED_BOOTIMAGE_TARGET)

......</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
如果定义在FULL_BUILD这个变量，就意味着我们是要对整个系统进行编译，并且编译完成之后 
，需要将编译得到的文件进行打包，以便可以得到相应的镜像文件，否则的话，就仅仅是对某些模块进行编译。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在前面<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/18928789">Android编译系统环境初始化过程分析</a>一
篇文章中，我们提到，变量INTERNAL_PRODUCT描述的是执行lunch命令时所选择的产品所对应的产品Makefile文件，而变量
PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES描述的是在该产品Makefile文件中通过变量
PRODUCT_PACKAGES所定义的模块名称列表。因此，我们得到的变量product_MODULES描述的就是要安装的模块名称列表。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
我们知道，Android源码中自带了很多默认的APK模块。如果我们想用自己编写的一个APK来代替某一个系统自带的APK，那么就可以通过变量
PACKAGES.&lt;new&gt;.OVERRIDES := 
&lt;old&gt;来说明。其中，&lt;new&gt;表示用来替换的APK，而&lt;old&gt;表示被替换的APK。在这种情况下，被替换
的APK是不应该被打包到系统镜像中去的。因此，我们需要从上一步得到的模块名称列表中剔除那些被替换的APK，这是通过Makefile脚本提供的
filter-out函数来完成的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
一个模块可以通过LOCAL_REQUIRED_MODULES变量来指定它所依赖的其它模块，因此，当一个模块被安装的时候，它所依赖的其它模块也会一
起被安装。调用函数expand-required-modules获得的就是所有要安装的模块所依赖的其它模块，并且将这些被依赖的模块也一起保存在变
量product_MODULES中。<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
注意，这时候我们得到的product_MODULES描述的仅仅是要安装的模块的名称，但是我们实际需要的这些模块对应的具体文件，因此，需要进一步调
用函数module-installed-files来获得要安装的模块所对应的文件，也就是要安装的模块经过编译之后生成的文件，这些文件就保存在变量
product_FILES中。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 最终需要安装的文件除了变量product_FILES所描述的文件之后， 还包含以下四类模块文件：</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 变量ALL_DEFAULT_INSTALLED_MODULES描述的文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. 变量CUSTOM_MODULES描述的文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 3. 
与当前编译类型对应的模块文件。例如，如果当前设定的编译类型为debug，那么所有通过将变量LOCAL_MODULE_TAGS将自己设置为
debug的模块也会被打包到系统镜像文件中去。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. 
与当前shell名称对应的模块文件。例如，如果当前使用的shell是mksh，那么所有通过将变量LOCAL_MODULE_TAGS将自己设置为
shell_mksh的模块也会被打包到系统镜像文件中去。<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
最后，modules_to_install就描述当前需要打包到系统镜像中去的模块文件。实际上，我们除了可以通过
PACKAGES.$(p).OVERRIDES来描述要替换的APK之后，还可以在一个模块中通过LOCAL_OVERRIDES_PACKAGES来
描述它所替换的模块。因此，我们需要通过函数get-package-overrides来获得此类被替换的模块文件，并且将它们从
modules_to_install中剔除，这样得到的模块文件才是最终需要安装的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
确定了要安装的所有模块文件之后，就可以将build/core/Makefile文件加载进来了。注意，文件build/core/Makefile是
通过变量ALL_DEFAULT_INSTALLED_MODULES来获得当前所有要打包到系统镜像文件中去的模块文件的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
文件build/core/Makefile主要就是用来打包各种Android系统镜像文件的，当然它也是通过make规则来执行各种Android系
统镜像文件打包命令的。每一个Android镜像文件都对应有一个make伪目标。例如，在build/core/main.mk文件中，就定义了三个
make伪目标ramdisk、userdataimage和bootimage，它们分别依赖于变量
INSTALLED_USERDATAIMAGE_TARGET、INSTALLED_USERDATAIMAGE_TARGET和
INSTALLED_BOOTIMAGE_TARGET所描述的文件，并且它们分别表示的就是ramdisk.img、userdata.img和
boot.img文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
变量INSTALLED_USERDATAIMAGE_TARGET、INSTALLED_USERDATAIMAGE_TARGET和
INSTALLED_BOOTIMAGE_TARGET都是在build/core/Makefile文件中定义的。此外，build/core
/Makefile文件还定义了另外两个镜像文件system.img和recovery.img的生成规则。接下来，我们就分别对这些镜像文件的打包过
程进行分析。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一. system.img<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; system.img镜像文件描述的是设备上的system分区，即/system目录，它是在build/core/Makefile文件中生成的，相关的内容如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 3778px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_2" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_2" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>#&nbsp;Rules&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;present&nbsp;for&nbsp;the&nbsp;all&nbsp;targets,&nbsp;even&nbsp;&nbsp;</span></span></li><li class=""><span>#&nbsp;if&nbsp;they&nbsp;don't&nbsp;do&nbsp;anything.&nbsp;&nbsp;</span></li><li class="alt"><span>.PHONY:&nbsp;systemimage&nbsp;&nbsp;</span></li><li class=""><span>systemimage:&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>INSTALLED_SYSTEMIMAGE&nbsp;:=&nbsp;$(PRODUCT_OUT)/system.img&nbsp;&nbsp;</span></li><li class=""><span>......&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>$(INSTALLED_SYSTEMIMAGE):&nbsp;$(BUILT_SYSTEMIMAGE)&nbsp;$(RECOVERY_FROM_BOOT_PATCH)&nbsp;|&nbsp;$(ACP)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;"Install&nbsp;system&nbsp;fs&nbsp;image:&nbsp;$@"&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(copy-file-to-target)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(call&nbsp;assert-max-image-size,$@&nbsp;$(RECOVERY_FROM_BOOT_PATCH),$(BOARD_SYSTEMIMAGE_PARTITION_SIZE),yaffs)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>systemimage:&nbsp;$(INSTALLED_SYSTEMIMAGE)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>.PHONY:&nbsp;systemimage-nodeps&nbsp;snod&nbsp;&nbsp;</span></li><li class=""><span>systemimage-nodeps&nbsp;snod:&nbsp;$(filter-out&nbsp;systemimage-nodeps&nbsp;snod,$(MAKECMDGOALS))&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;$(INTERNAL_USERIMAGES_DEPS)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;"make&nbsp;$@:&nbsp;ignoring&nbsp;dependencies"&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;build-systemimage-target,$(INSTALLED_SYSTEMIMAGE))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(call&nbsp;assert-max-image-size,$(INSTALLED_SYSTEMIMAGE),$(BOARD_SYSTEMIMAGE_PARTITION_SIZE),yaffs)&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain"># Rules that need to be present for the all targets, even
# if they don't do anything.
.PHONY: systemimage
systemimage:
......

INSTALLED_SYSTEMIMAGE := $(PRODUCT_OUT)/system.img
......

$(INSTALLED_SYSTEMIMAGE): $(BUILT_SYSTEMIMAGE) $(RECOVERY_FROM_BOOT_PATCH) | $(ACP)
    @echo "Install system fs image: $@"
    $(copy-file-to-target)
    $(hide) $(call assert-max-image-size,$@ $(RECOVERY_FROM_BOOT_PATCH),$(BOARD_SYSTEMIMAGE_PARTITION_SIZE),yaffs)

systemimage: $(INSTALLED_SYSTEMIMAGE)

.PHONY: systemimage-nodeps snod
systemimage-nodeps snod: $(filter-out systemimage-nodeps snod,$(MAKECMDGOALS)) \
                | $(INTERNAL_USERIMAGES_DEPS)
    @echo "make $@: ignoring dependencies"
    $(call build-systemimage-target,$(INSTALLED_SYSTEMIMAGE))
    $(hide) $(call assert-max-image-size,$(INSTALLED_SYSTEMIMAGE),$(BOARD_SYSTEMIMAGE_PARTITION_SIZE),yaffs)</pre><p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 从这里就可以看出，build/core/Makefile文件定义了两个伪目标来生成system.img：1. systemimg；2. 
systemimg-nodeps或者snod。伪目标systemimg表示在打包system.img之前，要根据依赖规则重新生成所有要进行打包的
文件，而伪目标systemimg-nodeps则不需要根据依赖规则重新生成所有需要打包的文件而直接打包system.img文件。因此，执行
systemimg-nodep比执行systemimg要快很多。通常，如果我们在Android源码中修改了某一个模块，并且这个模块不被其它模块依
赖，那么对这个模块进行编译之后，就可以简单地执行make 
systemimg-nodeps来重新打包system.img。但是，如果我们修改的模块会被其它模块引用，例如，我们修改了Android系统的核
心模块framework.jar和services.jar，那么就需要执行make 
systemimg来更新所有依赖于framework.jar和services.jar的模块，那么最后得到的system.img才是正确的镜像。
否则的话，会导致Android系统启动失败。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
接下来，我们就主要关注伪目标systemimg生成system.img镜像文件的过程。伪目标systemimg依赖于
INSTALLED_SYSTEMIMAGE，也就是最终生成的$(PRODUCT_OUT)/system.img文件。
INSTALLED_SYSTEMIMAGE又依赖于BUILT_SYSTEMIMAGE、RECOVERY_FROM_BOOT_PATCH和ACP。
注意，BUILT_SYSTEMIMAGE、RECOVERY_FROM_BOOT_PATCH和ACP之间有一个管道符号相隔。在一个make规则之
中，一个目标的依赖文件可以划分为两类。一个类是普通依赖文件，它们位于管道符号的左则，另一类称为“order-only”依赖文件，它们位于管理符号
的右侧。每一个普通依赖文件发生修改后，目标都会被更新。但是"order-only"依赖文件发生修改时，却不一定会导致目标更新。只有当目标文件不存
在的情况下，"order-only"依赖文件的修改才会更新目标文件。也就是说，只有在目标文件不存在的情况下，“order-only”依赖文件才会
参与到规则的执行过程中去。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ACP描述的是一个Android专用的cp命令，在生成system.img镜像文件的过程中是需要用到的。普通的cp命令在不同的平台（Mac OS
 
X、MinGW/Cygwin和Linux）的实现略有差异，并且可能会导致一些问题，于是Android编译系统就重写了自己的cp命令，使得它在不同
平台下执行具有统一的行为，并且解决普通cp命令可能会出现的问题。例如，在Linux平台上，当我们把一个文件从NFS文件系统拷贝到本地文件系统时，
普通的cp命令总是会认为在NFS文件系统上的文件比在本地文件系统上的文件要新，因为前者的时间戳精度是微秒，而后者的时间戳精度不是微秒。
Android专用的cp命令源码可以参考build/tools/acp目录。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RECOVERY_FROM_BOOT_PATCH描述的是一个patch文件，它的依赖规则如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 4971px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_3" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_3" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>#&nbsp;The&nbsp;system&nbsp;partition&nbsp;needs&nbsp;room&nbsp;for&nbsp;the&nbsp;recovery&nbsp;image&nbsp;as&nbsp;well.&nbsp;&nbsp;We&nbsp;&nbsp;</span></span></li><li class=""><span>#&nbsp;now&nbsp;store&nbsp;the&nbsp;recovery&nbsp;image&nbsp;as&nbsp;a&nbsp;binary&nbsp;patch&nbsp;using&nbsp;the&nbsp;boot&nbsp;image&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;as&nbsp;the&nbsp;source&nbsp;(since&nbsp;they&nbsp;are&nbsp;very&nbsp;similar).&nbsp;&nbsp;Generate&nbsp;the&nbsp;patch&nbsp;so&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;we&nbsp;can&nbsp;see&nbsp;how&nbsp;big&nbsp;it's&nbsp;going&nbsp;to&nbsp;be,&nbsp;and&nbsp;include&nbsp;that&nbsp;in&nbsp;the&nbsp;system&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;image&nbsp;size&nbsp;check&nbsp;calculation.&nbsp;&nbsp;</span></li><li class=""><span>ifneq&nbsp;($(INSTALLED_RECOVERYIMAGE_TARGET),)&nbsp;&nbsp;</span></li><li class="alt"><span>intermediates&nbsp;:=&nbsp;$(call&nbsp;intermediates-dir-for,PACKAGING,recovery_patch)&nbsp;&nbsp;</span></li><li class=""><span>RECOVERY_FROM_BOOT_PATCH&nbsp;:=&nbsp;$(intermediates)/recovery_from_boot.p&nbsp;&nbsp;</span></li><li class="alt"><span>$(RECOVERY_FROM_BOOT_PATCH):&nbsp;$(INSTALLED_RECOVERYIMAGE_TARGET)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(INSTALLED_BOOTIMAGE_TARGET)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(HOST_OUT_EXECUTABLES)/imgdiff&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(HOST_OUT_EXECUTABLES)/bsdiff&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;"Construct&nbsp;recovery&nbsp;from&nbsp;boot"&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;PATH=$(HOST_OUT_EXECUTABLES):$$PATH&nbsp;$(HOST_OUT_EXECUTABLES)/imgdiff&nbsp;$(INSTALLED_BOOTIMAGE_TARGET)&nbsp;$(INSTALLED_RECOVERYIMAGE_TARGET)&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain"># The system partition needs room for the recovery image as well.  We
# now store the recovery image as a binary patch using the boot image
# as the source (since they are very similar).  Generate the patch so
# we can see how big it's going to be, and include that in the system
# image size check calculation.
ifneq ($(INSTALLED_RECOVERYIMAGE_TARGET),)
intermediates := $(call intermediates-dir-for,PACKAGING,recovery_patch)
RECOVERY_FROM_BOOT_PATCH := $(intermediates)/recovery_from_boot.p
$(RECOVERY_FROM_BOOT_PATCH): $(INSTALLED_RECOVERYIMAGE_TARGET) \
                             $(INSTALLED_BOOTIMAGE_TARGET) \
                 $(HOST_OUT_EXECUTABLES)/imgdiff \
                         $(HOST_OUT_EXECUTABLES)/bsdiff
    @echo "Construct recovery from boot"
    mkdir -p $(dir $@)
    PATH=$(HOST_OUT_EXECUTABLES):$$PATH $(HOST_OUT_EXECUTABLES)/imgdiff $(INSTALLED_BOOTIMAGE_TARGET) $(INSTALLED_RECOVERYIMAGE_TARGET) $@
endif</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
这个patch文件的名称为recovery_from_boot.p，保存在设备上system分区中，描述的是recovery.img与
boot.img之间的差异。也就是说，在设备上，我们可以通过boot.img和recovery_from_boot.p文件生成一个
recovery.img文件，使得设备可以进入recovery模式。<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSTALLED_SYSTEMIMAGE描述的是system.img镜像所包含的核心文件，它的依赖规则如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 5459px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_4" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_4" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>systemimage_intermediates&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;intermediates-dir-for,PACKAGING,systemimage)&nbsp;&nbsp;</span></li><li class="alt"><span>BUILT_SYSTEMIMAGE&nbsp;:=&nbsp;$(systemimage_intermediates)/system.img&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;$(1):&nbsp;output&nbsp;file&nbsp;&nbsp;</span></li><li class=""><span>define&nbsp;build-systemimage-target&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;@echo&nbsp;"Target&nbsp;system&nbsp;fs&nbsp;image:&nbsp;$(1)"&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(dir&nbsp;$(1))&nbsp;$(systemimage_intermediates)&nbsp;&amp;&amp;&nbsp;rm&nbsp;-rf&nbsp;$(systemimage_intermediates)/system_image_info.txt&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;$(call&nbsp;generate-userimage-prop-dictionary,&nbsp;$(systemimage_intermediates)/system_image_info.txt)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;$(hide)&nbsp;PATH=$(foreach&nbsp;p,$(INTERNAL_USERIMAGES_BINARY_PATHS),$(p):)$$PATH&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./build/tools/releasetools/build_image.py&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(TARGET_OUT)&nbsp;$(systemimage_intermediates)/system_image_info.txt&nbsp;$(1)&nbsp;&nbsp;</span></li><li class="alt"><span>endef&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>$(BUILT_SYSTEMIMAGE):&nbsp;$(FULL_SYSTEMIMAGE_DEPS)&nbsp;$(INSTALLED_FILES_FILE)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;build-systemimage-target,$@)&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">systemimage_intermediates := \
    $(call intermediates-dir-for,PACKAGING,systemimage)
BUILT_SYSTEMIMAGE := $(systemimage_intermediates)/system.img

# $(1): output file
define build-systemimage-target
  @echo "Target system fs image: $(1)"
  @mkdir -p $(dir $(1)) $(systemimage_intermediates) &amp;&amp; rm -rf $(systemimage_intermediates)/system_image_info.txt
  $(call generate-userimage-prop-dictionary, $(systemimage_intermediates)/system_image_info.txt)
  $(hide) PATH=$(foreach p,$(INTERNAL_USERIMAGES_BINARY_PATHS),$(p):)$$PATH \
      ./build/tools/releasetools/build_image.py \
      $(TARGET_OUT) $(systemimage_intermediates)/system_image_info.txt $(1)
endef

$(BUILT_SYSTEMIMAGE): $(FULL_SYSTEMIMAGE_DEPS) $(INSTALLED_FILES_FILE)
    $(call build-systemimage-target,$@)</pre><p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
INSTALLED_SYSTEMIMAGE描述的是$(systemimage_intermediates)/system.img文件，它依赖于
FULL_SYSTEMIMAGE_DEPS和INSTALLED_FILES_FILE，并且是通过调用函数build-systemimage-
target来生成，而函数build-systemimage-target实际上又是通过调用python脚本build_image.py来生成
system.img文件的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSTALLED_FILES_FILE的依赖规则如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 5965px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_5" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_5" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>#&nbsp;-----------------------------------------------------------------&nbsp;&nbsp;</span></span></li><li class=""><span>#&nbsp;installed&nbsp;file&nbsp;list&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Depending&nbsp;on&nbsp;anything&nbsp;that&nbsp;$(BUILT_SYSTEMIMAGE)&nbsp;depends&nbsp;on.&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;We&nbsp;put&nbsp;installed-files.txt&nbsp;ahead&nbsp;of&nbsp;image&nbsp;itself&nbsp;in&nbsp;the&nbsp;dependency&nbsp;graph&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;size&nbsp;stat&nbsp;even&nbsp;if&nbsp;the&nbsp;build&nbsp;fails&nbsp;due&nbsp;to&nbsp;too&nbsp;large&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;system&nbsp;image.&nbsp;&nbsp;</span></li><li class="alt"><span>INSTALLED_FILES_FILE&nbsp;:=&nbsp;$(PRODUCT_OUT)/installed-files.txt&nbsp;&nbsp;</span></li><li class=""><span>$(INSTALLED_FILES_FILE):&nbsp;$(FULL_SYSTEMIMAGE_DEPS)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;Installed&nbsp;file&nbsp;list:&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@rm&nbsp;-f&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;build/tools/fileslist.py&nbsp;$(TARGET_OUT)&nbsp;&gt;&nbsp;$@&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain"># -----------------------------------------------------------------
# installed file list
# Depending on anything that $(BUILT_SYSTEMIMAGE) depends on.
# We put installed-files.txt ahead of image itself in the dependency graph
# so that we can get the size stat even if the build fails due to too large
# system image.
INSTALLED_FILES_FILE := $(PRODUCT_OUT)/installed-files.txt
$(INSTALLED_FILES_FILE): $(FULL_SYSTEMIMAGE_DEPS)
    @echo Installed file list: $@
    @mkdir -p $(dir $@)
    @rm -f $@
    $(hide) build/tools/fileslist.py $(TARGET_OUT) &gt; $@</pre>&nbsp; 
&nbsp; &nbsp; 
&nbsp;&nbsp;INSTALLED_FILES_FILE描述的是$(PRODUCT_OUT)/installed-files.txt文
件，该文件描述了要打包在system.img镜像中去的文件列表，同时它与INSTALLED_SYSTEMIMAGE一样，也依赖于
FULL_SYSTEMIMAGE_DEPS。 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FULL_SYSTEMIMAGE_DEPS的定义如下所示：<div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 6354px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_6" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_6" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>FULL_SYSTEMIMAGE_DEPS&nbsp;:=&nbsp;$(INTERNAL_SYSTEMIMAGE_FILES)&nbsp;$(INTERNAL_USERIMAGES_DEPS)&nbsp;&nbsp;</span></span></li></ol></div><pre style="display: none;" name="code" class="plain">FULL_SYSTEMIMAGE_DEPS := $(INTERNAL_SYSTEMIMAGE_FILES) $(INTERNAL_USERIMAGES_DEPS)</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
INTERNAL_USERIMAGES_DEPS描述的是制作system.img镜像所依赖的工具。例如，如果要制作的system.img使用的是
yaffs2文件系统，那么对应工具就是mkyaffs2image。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INTERNAL_SYSTEMIMAGE_FILES描述的是用来制作system.img镜像的文件，它的定义如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 6533px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_7" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_7" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>INTERNAL_SYSTEMIMAGE_FILES&nbsp;:=&nbsp;$(filter&nbsp;$(TARGET_OUT)/%,&nbsp;\&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_PREBUILT)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_COPIED_HEADERS)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_GENERATED_SOURCES)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_DEFAULT_INSTALLED_MODULES)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(PDK_FUSION_SYSIMG_FILES)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(RECOVERY_RESOURCE_ZIP))&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">INTERNAL_SYSTEMIMAGE_FILES := $(filter $(TARGET_OUT)/%, \
    $(ALL_PREBUILT) \
    $(ALL_COPIED_HEADERS) \
    $(ALL_GENERATED_SOURCES) \
    $(ALL_DEFAULT_INSTALLED_MODULES) \
    $(PDK_FUSION_SYSIMG_FILES) \
    $(RECOVERY_RESOURCE_ZIP))</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
从这里就可以看出，INTERNAL_SYSTEMIMAGE_FILES描述的就是从ALL_PREBUILT、
ALL_COPIED_HEADERS、ALL_GENERATED_SOURCES、ALL_DEFAULT_INSTALLED_MODULES、
PDK_FUSION_SYSIMG_FILES和RECOVERY_RESOURCE_ZIP中过滤出来的存放在TARGET_OUT目录下的那些文
件，即在目标产品输出目录中的system子目录下那些文件。<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL_PREBUILT是一个过时的变量，用来描述要拷贝到目标设备上去的文件，现在建议使用PRODUCT_COPY_FILES来描述要拷贝到目标设备上去的文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL_COPIED_HEADERS描述的是要拷贝到目标设备上去的头文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ALL_GENERATED_SOURCES描述的是要拷贝到目标设备上去的由工具自动生成的源代码文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
ALL_DEFAULT_INSTALLED_MODULES描述的就是要安装要目标设备上的模块文件，这些模块文件是在build/core
/main.mk文件中设置好并且传递给build/core/Makefile文件使用的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 PDK_FUSION_SYSIMG_FILES是从PDK(Platform Development 
Kit)提取出来的相关文件。PDK是Google为了解决Android碎片化问题而为手机厂商提供的一个新版本的、还未发布的Android开发包，
目的是为了让手机厂商跟上官方新版Android的开发节奏。具体可以参考这篇文章：http://www.xinwengao.net/release
/af360/67079.shtml。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
RECOVERY_RESOURCE_ZIP描述的是Android的recovery系统要使用的资源文件，对应于/system/etc目录下的
recovery-resource.dat文件。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 注意，ALL_DEFAULT_INSTALLED_MODULES描述的文件除了在build/core/main.mk文件中定义的模块文件之外，还包含以下这些文件：</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 通过PRODUCT_COPY_FILES定义的要拷贝到目标设备上去的文件</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 7334px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_8" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_8" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=8&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>unique_product_copy_files_pairs&nbsp;:=&nbsp;&nbsp;</span></span></li><li class=""><span>$(foreach&nbsp;cf,$(PRODUCT_COPY_FILES),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(if&nbsp;$(filter&nbsp;$(unique_product_copy_files_pairs),$(cf)),,\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;unique_product_copy_files_pairs&nbsp;+=&nbsp;$(cf))))&nbsp;&nbsp;</span></li><li class="alt"><span>unique_product_copy_files_destinations&nbsp;:=&nbsp;&nbsp;</span></li><li class=""><span>$(foreach&nbsp;cf,$(unique_product_copy_files_pairs),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;_src&nbsp;:=&nbsp;$(call&nbsp;word-colon,1,$(cf)))&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;_dest&nbsp;:=&nbsp;$(call&nbsp;word-colon,2,$(cf)))&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;check-product-copy-files,$(cf))&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(if&nbsp;$(filter&nbsp;$(unique_product_copy_files_destinations),$(_dest)),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(info&nbsp;PRODUCT_COPY_FILES&nbsp;$(cf)&nbsp;ignored.),&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;_fulldest&nbsp;:=&nbsp;$(call&nbsp;append-path,$(PRODUCT_OUT),$(_dest)))&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(if&nbsp;$(filter&nbsp;%.xml,$(_dest)),\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;$(call&nbsp;copy-xml-file-checked,$(_src),$(_fulldest))),\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;$(call&nbsp;copy-one-file,$(_src),$(_fulldest))))&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;style="color:#FF0000;"&gt;&lt;strong&gt;$(eval&nbsp;ALL_DEFAULT_INSTALLED_MODULES&nbsp;+=&nbsp;$(_fulldest))&nbsp;\&lt;/strong&gt;&lt;/span&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(eval&nbsp;unique_product_copy_files_destinations&nbsp;+=&nbsp;$(_dest))))&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">unique_product_copy_files_pairs :=
$(foreach cf,$(PRODUCT_COPY_FILES), \
    $(if $(filter $(unique_product_copy_files_pairs),$(cf)),,\
        $(eval unique_product_copy_files_pairs += $(cf))))
unique_product_copy_files_destinations :=
$(foreach cf,$(unique_product_copy_files_pairs), \
    $(eval _src := $(call word-colon,1,$(cf))) \
    $(eval _dest := $(call word-colon,2,$(cf))) \
    $(call check-product-copy-files,$(cf)) \
    $(if $(filter $(unique_product_copy_files_destinations),$(_dest)), \
        $(info PRODUCT_COPY_FILES $(cf) ignored.), \
        $(eval _fulldest := $(call append-path,$(PRODUCT_OUT),$(_dest))) \
        $(if $(filter %.xml,$(_dest)),\
            $(eval $(call copy-xml-file-checked,$(_src),$(_fulldest))),\
            $(eval $(call copy-one-file,$(_src),$(_fulldest)))) \
        <span style="color:#FF0000;"><strong>$(eval ALL_DEFAULT_INSTALLED_MODULES += $(_fulldest)) \</strong></span>
        $(eval unique_product_copy_files_destinations += $(_dest))))</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2.&nbsp; 由ADDITIONAL_DEFAULT_PROPERTIES定义的属性所组成的default.prop文件<p></p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 7753px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_9" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_9" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=9&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>INSTALLED_DEFAULT_PROP_TARGET&nbsp;:=&nbsp;$(TARGET_ROOT_OUT)/default.prop&nbsp;&nbsp;</span></span></li><li class=""><span>&lt;span&nbsp;style="color:#FF0000;"&gt;&lt;strong&gt;ALL_DEFAULT_INSTALLED_MODULES&nbsp;+=&nbsp;$(INSTALLED_DEFAULT_PROP_TARGET)&lt;/strong&gt;&lt;/span&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>ADDITIONAL_DEFAULT_PROPERTIES&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;collapse-pairs,&nbsp;$(ADDITIONAL_DEFAULT_PROPERTIES))&nbsp;&nbsp;</span></li><li class="alt"><span>ADDITIONAL_DEFAULT_PROPERTIES&nbsp;+=&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;collapse-pairs,&nbsp;$(PRODUCT_DEFAULT_PROPERTY_OVERRIDES))&nbsp;&nbsp;</span></li><li class="alt"><span>ADDITIONAL_DEFAULT_PROPERTIES&nbsp;:=&nbsp;$(call&nbsp;uniq-pairs-by-first-component,&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ADDITIONAL_DEFAULT_PROPERTIES),=)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>$(INSTALLED_DEFAULT_PROP_TARGET):&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;Target&nbsp;buildinfo:&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;echo&nbsp;"#"&nbsp;&gt;&nbsp;$@;&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"#&nbsp;ADDITIONAL_DEFAULT_PROPERTIES"&nbsp;&gt;&gt;&nbsp;$@;&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"#"&nbsp;&gt;&gt;&nbsp;$@;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(foreach&nbsp;line,$(ADDITIONAL_DEFAULT_PROPERTIES),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"$(line)"&nbsp;&gt;&gt;&nbsp;$@;)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;build/tools/post_process_props.py&nbsp;$@&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">INSTALLED_DEFAULT_PROP_TARGET := $(TARGET_ROOT_OUT)/default.prop
<span style="color:#FF0000;"><strong>ALL_DEFAULT_INSTALLED_MODULES += $(INSTALLED_DEFAULT_PROP_TARGET)</strong></span>
ADDITIONAL_DEFAULT_PROPERTIES := \
    $(call collapse-pairs, $(ADDITIONAL_DEFAULT_PROPERTIES))
ADDITIONAL_DEFAULT_PROPERTIES += \
    $(call collapse-pairs, $(PRODUCT_DEFAULT_PROPERTY_OVERRIDES))
ADDITIONAL_DEFAULT_PROPERTIES := $(call uniq-pairs-by-first-component, \
    $(ADDITIONAL_DEFAULT_PROPERTIES),=)

$(INSTALLED_DEFAULT_PROP_TARGET):
    @echo Target buildinfo: $@
    @mkdir -p $(dir $@)
    $(hide) echo "#" &gt; $@; \
            echo "# ADDITIONAL_DEFAULT_PROPERTIES" &gt;&gt; $@; \
            echo "#" &gt;&gt; $@;
    $(hide) $(foreach line,$(ADDITIONAL_DEFAULT_PROPERTIES), \
        echo "$(line)" &gt;&gt; $@;)
    build/tools/post_process_props.py $@</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. 由ADDITIONAL_BUILD_PROPERTIES等定义的属性所组成的build.prop文件<p></p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 8190px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_10" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_10" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=10&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>INSTALLED_BUILD_PROP_TARGET&nbsp;:=&nbsp;$(TARGET_OUT)/build.prop&nbsp;&nbsp;</span></span></li><li class=""><span>&lt;span&nbsp;style="color:#FF0000;"&gt;&lt;strong&gt;ALL_DEFAULT_INSTALLED_MODULES&nbsp;+=&nbsp;$(INSTALLED_BUILD_PROP_TARGET)&lt;/strong&gt;&lt;/span&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>ADDITIONAL_BUILD_PROPERTIES&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;collapse-pairs,&nbsp;$(ADDITIONAL_BUILD_PROPERTIES))&nbsp;&nbsp;</span></li><li class="alt"><span>ADDITIONAL_BUILD_PROPERTIES&nbsp;:=&nbsp;$(call&nbsp;uniq-pairs-by-first-component,&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ADDITIONAL_BUILD_PROPERTIES),=)&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>BUILDINFO_SH&nbsp;:=&nbsp;build/tools/buildinfo.sh&nbsp;&nbsp;</span></li><li class="alt"><span>$(INSTALLED_BUILD_PROP_TARGET):&nbsp;$(BUILDINFO_SH)&nbsp;$(INTERNAL_BUILD_ID_MAKEFILE)&nbsp;$(BUILD_SYSTEM)/version_defaults.mk&nbsp;$(wildcard&nbsp;$(TARGET_DEVICE_DIR)/system.prop)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;Target&nbsp;buildinfo:&nbsp;$@&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;TARGET_BUILD_TYPE="$(TARGET_BUILD_VARIANT)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TARGET_DEVICE="$(TARGET_DEVICE)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_NAME="$(TARGET_PRODUCT)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_BRAND="$(PRODUCT_BRAND)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_DEFAULT_LANGUAGE="$(call&nbsp;default-locale-language,$(PRODUCT_LOCALES))"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_DEFAULT_REGION="$(call&nbsp;default-locale-region,$(PRODUCT_LOCALES))"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_DEFAULT_WIFI_CHANNELS="$(PRODUCT_DEFAULT_WIFI_CHANNELS)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_MODEL="$(PRODUCT_MODEL)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRODUCT_MANUFACTURER="$(PRODUCT_MANUFACTURER)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PRIVATE_BUILD_DESC="$(PRIVATE_BUILD_DESC)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUILD_ID="$(BUILD_ID)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUILD_DISPLAY_ID="$(BUILD_DISPLAY_ID)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUILD_NUMBER="$(BUILD_NUMBER)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PLATFORM_VERSION="$(PLATFORM_VERSION)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PLATFORM_SDK_VERSION="$(PLATFORM_SDK_VERSION)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PLATFORM_VERSION_CODENAME="$(PLATFORM_VERSION_CODENAME)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUILD_VERSION_TAGS="$(BUILD_VERSION_TAGS)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TARGET_BOOTLOADER_BOARD_NAME="$(TARGET_BOOTLOADER_BOARD_NAME)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BUILD_FINGERPRINT="$(BUILD_FINGERPRINT)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TARGET_BOARD_PLATFORM="$(TARGET_BOARD_PLATFORM)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TARGET_CPU_ABI="$(TARGET_CPU_ABI)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TARGET_CPU_ABI2="$(TARGET_CPU_ABI2)"&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TARGET_AAPT_CHARACTERISTICS="$(TARGET_AAPT_CHARACTERISTICS)"&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bash&nbsp;$(BUILDINFO_SH)&nbsp;&gt;&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;if&nbsp;[&nbsp;-f&nbsp;$(TARGET_DEVICE_DIR)/system.prop&nbsp;];&nbsp;then&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat&nbsp;$(TARGET_DEVICE_DIR)/system.prop&nbsp;&gt;&gt;&nbsp;$@;&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(if&nbsp;$(ADDITIONAL_BUILD_PROPERTIES),&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;echo&nbsp;&gt;&gt;&nbsp;$@;&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"#"&nbsp;&gt;&gt;&nbsp;$@;&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"#&nbsp;ADDITIONAL_BUILD_PROPERTIES"&nbsp;&gt;&gt;&nbsp;$@;&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"#"&nbsp;&gt;&gt;&nbsp;$@;&nbsp;)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(foreach&nbsp;line,$(ADDITIONAL_BUILD_PROPERTIES),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;"$(line)"&nbsp;&gt;&gt;&nbsp;$@;)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;build/tools/post_process_props.py&nbsp;$@&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">INSTALLED_BUILD_PROP_TARGET := $(TARGET_OUT)/build.prop
<span style="color:#FF0000;"><strong>ALL_DEFAULT_INSTALLED_MODULES += $(INSTALLED_BUILD_PROP_TARGET)</strong></span>
ADDITIONAL_BUILD_PROPERTIES := \
    $(call collapse-pairs, $(ADDITIONAL_BUILD_PROPERTIES))
ADDITIONAL_BUILD_PROPERTIES := $(call uniq-pairs-by-first-component, \
    $(ADDITIONAL_BUILD_PROPERTIES),=)
......
BUILDINFO_SH := build/tools/buildinfo.sh
$(INSTALLED_BUILD_PROP_TARGET): $(BUILDINFO_SH) $(INTERNAL_BUILD_ID_MAKEFILE) $(BUILD_SYSTEM)/version_defaults.mk $(wildcard $(TARGET_DEVICE_DIR)/system.prop)
    @echo Target buildinfo: $@
    @mkdir -p $(dir $@)
    $(hide) TARGET_BUILD_TYPE="$(TARGET_BUILD_VARIANT)" \
            TARGET_DEVICE="$(TARGET_DEVICE)" \
            PRODUCT_NAME="$(TARGET_PRODUCT)" \
            PRODUCT_BRAND="$(PRODUCT_BRAND)" \
            PRODUCT_DEFAULT_LANGUAGE="$(call default-locale-language,$(PRODUCT_LOCALES))" \
            PRODUCT_DEFAULT_REGION="$(call default-locale-region,$(PRODUCT_LOCALES))" \
            PRODUCT_DEFAULT_WIFI_CHANNELS="$(PRODUCT_DEFAULT_WIFI_CHANNELS)" \
            PRODUCT_MODEL="$(PRODUCT_MODEL)" \
            PRODUCT_MANUFACTURER="$(PRODUCT_MANUFACTURER)" \
            PRIVATE_BUILD_DESC="$(PRIVATE_BUILD_DESC)" \
            BUILD_ID="$(BUILD_ID)" \
            BUILD_DISPLAY_ID="$(BUILD_DISPLAY_ID)" \
            BUILD_NUMBER="$(BUILD_NUMBER)" \
            PLATFORM_VERSION="$(PLATFORM_VERSION)" \
            PLATFORM_SDK_VERSION="$(PLATFORM_SDK_VERSION)" \
            PLATFORM_VERSION_CODENAME="$(PLATFORM_VERSION_CODENAME)" \
            BUILD_VERSION_TAGS="$(BUILD_VERSION_TAGS)" \
            TARGET_BOOTLOADER_BOARD_NAME="$(TARGET_BOOTLOADER_BOARD_NAME)" \
            BUILD_FINGERPRINT="$(BUILD_FINGERPRINT)" \
            TARGET_BOARD_PLATFORM="$(TARGET_BOARD_PLATFORM)" \
            TARGET_CPU_ABI="$(TARGET_CPU_ABI)" \
            TARGET_CPU_ABI2="$(TARGET_CPU_ABI2)" \
            TARGET_AAPT_CHARACTERISTICS="$(TARGET_AAPT_CHARACTERISTICS)" \
            bash $(BUILDINFO_SH) &gt; $@
    $(hide) if [ -f $(TARGET_DEVICE_DIR)/system.prop ]; then \
              cat $(TARGET_DEVICE_DIR)/system.prop &gt;&gt; $@; \
            fi
    $(if $(ADDITIONAL_BUILD_PROPERTIES), \
        $(hide) echo &gt;&gt; $@; \
                echo "#" &gt;&gt; $@; \
                echo "# ADDITIONAL_BUILD_PROPERTIES" &gt;&gt; $@; \
                echo "#" &gt;&gt; $@; )
    $(hide) $(foreach line,$(ADDITIONAL_BUILD_PROPERTIES), \
        echo "$(line)" &gt;&gt; $@;)
    $(hide) build/tools/post_process_props.py $@</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. 用来描述event类型日志格式的event-log-tags文件<p></p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 9180px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_11" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_11" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=11&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>all_event_log_tags_file&nbsp;:=&nbsp;$(TARGET_OUT_COMMON_INTERMEDIATES)/all-event-log-tags.txt&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>event_log_tags_file&nbsp;:=&nbsp;$(TARGET_OUT)/etc/event-log-tags&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Include&nbsp;tags&nbsp;from&nbsp;all&nbsp;packages&nbsp;that&nbsp;we&nbsp;know&nbsp;about&nbsp;&nbsp;</span></li><li class=""><span>all_event_log_tags_src&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(sort&nbsp;$(foreach&nbsp;m,&nbsp;$(ALL_MODULES),&nbsp;$(ALL_MODULES.$(m).EVENT_LOG_TAGS)))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;PDK&nbsp;builds&nbsp;will&nbsp;already&nbsp;have&nbsp;a&nbsp;full&nbsp;list&nbsp;of&nbsp;tags&nbsp;that&nbsp;needs&nbsp;to&nbsp;get&nbsp;merged&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;in&nbsp;with&nbsp;the&nbsp;ones&nbsp;from&nbsp;source&nbsp;&nbsp;</span></li><li class="alt"><span>pdk_fusion_log_tags_file&nbsp;:=&nbsp;$(patsubst&nbsp;$(PRODUCT_OUT)/%,$(_pdk_fusion_intermediates)/%,$(filter&nbsp;$(event_log_tags_file),$(ALL_PDK_FUSION_FILES)))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>$(all_event_log_tags_file):&nbsp;PRIVATE_SRC_FILES&nbsp;:=&nbsp;$(all_event_log_tags_src)&nbsp;$(pdk_fusion_log_tags_file)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;build/tools/merge-event-log-tags.py&nbsp;-o&nbsp;$@&nbsp;$(PRIVATE_SRC_FILES)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Include&nbsp;tags&nbsp;from&nbsp;all&nbsp;packages&nbsp;included&nbsp;in&nbsp;this&nbsp;product,&nbsp;plus&nbsp;all&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;tags&nbsp;that&nbsp;are&nbsp;part&nbsp;of&nbsp;the&nbsp;system&nbsp;(ie,&nbsp;not&nbsp;in&nbsp;a&nbsp;vendor/&nbsp;or&nbsp;device/&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;directory).&nbsp;&nbsp;</span></li><li class=""><span>event_log_tags_src&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(sort&nbsp;$(foreach&nbsp;m,\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;module-names-for-tag-list,user),&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_MODULES.$(m).EVENT_LOG_TAGS))&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(filter-out&nbsp;vendor/%&nbsp;device/%&nbsp;out/%,$(all_event_log_tags_src)))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>$(event_log_tags_file):&nbsp;PRIVATE_SRC_FILES&nbsp;:=&nbsp;$(event_log_tags_src)&nbsp;$(pdk_fusion_log_tags_file)&nbsp;&nbsp;</span></li><li class=""><span>$(event_log_tags_file):&nbsp;PRIVATE_MERGED_FILE&nbsp;:=&nbsp;$(all_event_log_tags_file)&nbsp;&nbsp;</span></li><li class="alt"><span>$(event_log_tags_file):&nbsp;$(event_log_tags_src)&nbsp;$(all_event_log_tags_file)&nbsp;$(pdk_fusion_log_tags_file)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;build/tools/merge-event-log-tags.py&nbsp;-o&nbsp;$@&nbsp;-m&nbsp;$(PRIVATE_MERGED_FILE)&nbsp;$(PRIVATE_SRC_FILES)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>event-log-tags:&nbsp;$(event_log_tags_file)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&lt;strong&gt;&lt;span&nbsp;style="color:#FF0000;"&gt;ALL_DEFAULT_INSTALLED_MODULES&nbsp;+=&nbsp;$(event_log_tags_file)&lt;/span&gt;&lt;/strong&gt;&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">all_event_log_tags_file := $(TARGET_OUT_COMMON_INTERMEDIATES)/all-event-log-tags.txt

event_log_tags_file := $(TARGET_OUT)/etc/event-log-tags

# Include tags from all packages that we know about
all_event_log_tags_src := \
    $(sort $(foreach m, $(ALL_MODULES), $(ALL_MODULES.$(m).EVENT_LOG_TAGS)))

# PDK builds will already have a full list of tags that needs to get merged
# in with the ones from source
pdk_fusion_log_tags_file := $(patsubst $(PRODUCT_OUT)/%,$(_pdk_fusion_intermediates)/%,$(filter $(event_log_tags_file),$(ALL_PDK_FUSION_FILES)))

$(all_event_log_tags_file): PRIVATE_SRC_FILES := $(all_event_log_tags_src) $(pdk_fusion_log_tags_file)
    $(hide) mkdir -p $(dir $@)
    $(hide) build/tools/merge-event-log-tags.py -o $@ $(PRIVATE_SRC_FILES)

# Include tags from all packages included in this product, plus all
# tags that are part of the system (ie, not in a vendor/ or device/
# directory).
event_log_tags_src := \
    $(sort $(foreach m,\
      $(PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES) \
      $(call module-names-for-tag-list,user), \
      $(ALL_MODULES.$(m).EVENT_LOG_TAGS)) \
      $(filter-out vendor/% device/% out/%,$(all_event_log_tags_src)))

$(event_log_tags_file): PRIVATE_SRC_FILES := $(event_log_tags_src) $(pdk_fusion_log_tags_file)
$(event_log_tags_file): PRIVATE_MERGED_FILE := $(all_event_log_tags_file)
$(event_log_tags_file): $(event_log_tags_src) $(all_event_log_tags_file) $(pdk_fusion_log_tags_file)
    $(hide) mkdir -p $(dir $@)
    $(hide) build/tools/merge-event-log-tags.py -o $@ -m $(PRIVATE_MERGED_FILE) $(PRIVATE_SRC_FILES)

event-log-tags: $(event_log_tags_file)

<strong><span style="color:#FF0000;">ALL_DEFAULT_INSTALLED_MODULES += $(event_log_tags_file)</span></strong></pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 关于Android系统的event日志，可以参考<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/6595744">Android日志系统驱动程序Logger源代码分析</a>、<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/6598703">Android应用程序框架层和系统运行库层日志系统源代码分析</a>和<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/6606957">Android日志系统Logcat源代码简要分析</a>这个系列的文章。<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5. 由于使用了BSD、GPL和Apache许可的模块而必须在发布时附带的Notice文件</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 10038px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_12" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_12" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=12&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>target_notice_file_txt&nbsp;:=&nbsp;$(TARGET_OUT_INTERMEDIATES)/NOTICE.txt&nbsp;&nbsp;</span></span></li><li class=""><span>target_notice_file_html&nbsp;:=&nbsp;$(TARGET_OUT_INTERMEDIATES)/NOTICE.html&nbsp;&nbsp;</span></li><li class="alt"><span>target_notice_file_html_gz&nbsp;:=&nbsp;$(TARGET_OUT_INTERMEDIATES)/NOTICE.html.gz&nbsp;&nbsp;</span></li><li class=""><span>tools_notice_file_txt&nbsp;:=&nbsp;$(HOST_OUT_INTERMEDIATES)/NOTICE.txt&nbsp;&nbsp;</span></li><li class="alt"><span>tools_notice_file_html&nbsp;:=&nbsp;$(HOST_OUT_INTERMEDIATES)/NOTICE.html&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>kernel_notice_file&nbsp;:=&nbsp;$(TARGET_OUT_NOTICE_FILES)/src/kernel.txt&nbsp;&nbsp;</span></li><li class=""><span>pdk_fusion_notice_files&nbsp;:=&nbsp;$(filter&nbsp;$(TARGET_OUT_NOTICE_FILES)/%,&nbsp;$(ALL_PDK_FUSION_FILES))&nbsp;&nbsp;</span></li><li class="alt"><span>......&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;Install&nbsp;the&nbsp;html&nbsp;file&nbsp;at&nbsp;/system/etc/NOTICE.html.gz.&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;This&nbsp;is&nbsp;not&nbsp;ideal,&nbsp;but&nbsp;this&nbsp;is&nbsp;very&nbsp;late&nbsp;in&nbsp;the&nbsp;game,&nbsp;after&nbsp;a&nbsp;lot&nbsp;of&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;the&nbsp;module&nbsp;processing&nbsp;has&nbsp;already&nbsp;been&nbsp;done&nbsp;--&nbsp;in&nbsp;fact,&nbsp;we&nbsp;used&nbsp;the&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;fact&nbsp;that&nbsp;all&nbsp;that&nbsp;has&nbsp;been&nbsp;done&nbsp;to&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;modules&nbsp;that&nbsp;we&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;need&nbsp;notice&nbsp;files&nbsp;for.&nbsp;&nbsp;</span></li><li class="alt"><span>$(target_notice_file_html_gz):&nbsp;$(target_notice_file_html)&nbsp;|&nbsp;$(MINIGZIP)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(MINIGZIP)&nbsp;-9&nbsp;&lt;&nbsp;$&lt;&nbsp;&gt;&nbsp;$@&nbsp;&nbsp;</span></li><li class="alt"><span>installed_notice_html_gz&nbsp;:=&nbsp;$(TARGET_OUT)/etc/NOTICE.html.gz&nbsp;&nbsp;</span></li><li class=""><span>$(installed_notice_html_gz):&nbsp;$(target_notice_file_html_gz)&nbsp;|&nbsp;$(ACP)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(copy-file-to-target)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;if&nbsp;we've&nbsp;been&nbsp;run&nbsp;my&nbsp;mm,&nbsp;mmm,&nbsp;etc,&nbsp;don't&nbsp;reinstall&nbsp;this&nbsp;every&nbsp;time&nbsp;&nbsp;</span></li><li class=""><span>ifeq&nbsp;($(ONE_SHOT_MAKEFILE),)&nbsp;&nbsp;</span></li><li class="alt"><span>&lt;span&nbsp;style="color:#FF0000;"&gt;&lt;strong&gt;ALL_DEFAULT_INSTALLED_MODULES&nbsp;+=&nbsp;$(installed_notice_html_gz)&lt;/strong&gt;&lt;/span&gt;&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">target_notice_file_txt := $(TARGET_OUT_INTERMEDIATES)/NOTICE.txt
target_notice_file_html := $(TARGET_OUT_INTERMEDIATES)/NOTICE.html
target_notice_file_html_gz := $(TARGET_OUT_INTERMEDIATES)/NOTICE.html.gz
tools_notice_file_txt := $(HOST_OUT_INTERMEDIATES)/NOTICE.txt
tools_notice_file_html := $(HOST_OUT_INTERMEDIATES)/NOTICE.html

kernel_notice_file := $(TARGET_OUT_NOTICE_FILES)/src/kernel.txt
pdk_fusion_notice_files := $(filter $(TARGET_OUT_NOTICE_FILES)/%, $(ALL_PDK_FUSION_FILES))
......
# Install the html file at /system/etc/NOTICE.html.gz.
# This is not ideal, but this is very late in the game, after a lot of
# the module processing has already been done -- in fact, we used the
# fact that all that has been done to get the list of modules that we
# need notice files for.
$(target_notice_file_html_gz): $(target_notice_file_html) | $(MINIGZIP)
    $(hide) $(MINIGZIP) -9 &lt; $&lt; &gt; $@
installed_notice_html_gz := $(TARGET_OUT)/etc/NOTICE.html.gz
$(installed_notice_html_gz): $(target_notice_file_html_gz) | $(ACP)
    $(copy-file-to-target)

# if we've been run my mm, mmm, etc, don't reinstall this every time
ifeq ($(ONE_SHOT_MAKEFILE),)
<span style="color:#FF0000;"><strong>ALL_DEFAULT_INSTALLED_MODULES += $(installed_notice_html_gz)</strong></span>
endif</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6. 用来验证OTA更新的证书文件<p></p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 10596px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_13" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_13" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=13&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>&lt;span&nbsp;style="color:#FF0000;"&gt;&lt;strong&gt;ALL_DEFAULT_INSTALLED_MODULES&nbsp;+=&nbsp;$(TARGET_OUT_ETC)/security/otacerts.zip&lt;/strong&gt;&lt;/span&gt;&nbsp;&nbsp;</span></span></li><li class=""><span>$(TARGET_OUT_ETC)/security/otacerts.zip:&nbsp;KEY_CERT_PAIR&nbsp;:=&nbsp;$(DEFAULT_KEY_CERT_PAIR)&nbsp;&nbsp;</span></li><li class="alt"><span>$(TARGET_OUT_ETC)/security/otacerts.zip:&nbsp;$(addsuffix&nbsp;.x509.pem,$(DEFAULT_KEY_CERT_PAIR))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;rm&nbsp;-f&nbsp;$@&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;zip&nbsp;-qj&nbsp;$@&nbsp;$&lt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>.PHONY:&nbsp;otacerts&nbsp;&nbsp;</span></li><li class="alt"><span>otacerts:&nbsp;$(TARGET_OUT_ETC)/security/otacerts.zip&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain"><span style="color:#FF0000;"><strong>ALL_DEFAULT_INSTALLED_MODULES += $(TARGET_OUT_ETC)/security/otacerts.zip</strong></span>
$(TARGET_OUT_ETC)/security/otacerts.zip: KEY_CERT_PAIR := $(DEFAULT_KEY_CERT_PAIR)
$(TARGET_OUT_ETC)/security/otacerts.zip: $(addsuffix .x509.pem,$(DEFAULT_KEY_CERT_PAIR))
    $(hide) rm -f $@
    $(hide) mkdir -p $(dir $@)
    $(hide) zip -qj $@ $&lt;

.PHONY: otacerts
otacerts: $(TARGET_OUT_ETC)/security/otacerts.zip</pre>&nbsp; &nbsp; &nbsp;&nbsp; 二. boot.img &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 从前面的分析可以知道，build/core/main.mk文件定义了boot.img镜像文件的依赖规则，我们可以通过执行make 
bootimage命令来执行。其中，bootimage是一个伪目标，它依赖于INSTALLED_BOOTIMAGE_TARGET。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSTALLED_BOOTIMAGE_TARGET定义在build/core/Makefile文件中，如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 10995px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_14" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_14" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=14&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>ifneq&nbsp;($(strip&nbsp;$(TARGET_NO_KERNEL)),true)&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;-----------------------------------------------------------------&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;the&nbsp;boot&nbsp;image,&nbsp;which&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;other&nbsp;images.&nbsp;&nbsp;</span></li><li class="alt"><span>INTERNAL_BOOTIMAGE_ARGS&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(addprefix&nbsp;--second&nbsp;,$(INSTALLED_2NDBOOTLOADER_TARGET))&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;--kernel&nbsp;$(INSTALLED_KERNEL_TARGET)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;--ramdisk&nbsp;$(INSTALLED_RAMDISK_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>INTERNAL_BOOTIMAGE_FILES&nbsp;:=&nbsp;$(filter-out&nbsp;--%,$(INTERNAL_BOOTIMAGE_ARGS))&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>BOARD_KERNEL_CMDLINE&nbsp;:=&nbsp;$(strip&nbsp;$(BOARD_KERNEL_CMDLINE))&nbsp;&nbsp;</span></li><li class="alt"><span>ifdef&nbsp;BOARD_KERNEL_CMDLINE&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;INTERNAL_BOOTIMAGE_ARGS&nbsp;+=&nbsp;--cmdline&nbsp;"$(BOARD_KERNEL_CMDLINE)"&nbsp;&nbsp;</span></li><li class="alt"><span>endif&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>BOARD_KERNEL_BASE&nbsp;:=&nbsp;$(strip&nbsp;$(BOARD_KERNEL_BASE))&nbsp;&nbsp;</span></li><li class=""><span>ifdef&nbsp;BOARD_KERNEL_BASE&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;INTERNAL_BOOTIMAGE_ARGS&nbsp;+=&nbsp;--base&nbsp;$(BOARD_KERNEL_BASE)&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>BOARD_KERNEL_PAGESIZE&nbsp;:=&nbsp;$(strip&nbsp;$(BOARD_KERNEL_PAGESIZE))&nbsp;&nbsp;</span></li><li class="alt"><span>ifdef&nbsp;BOARD_KERNEL_PAGESIZE&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;INTERNAL_BOOTIMAGE_ARGS&nbsp;+=&nbsp;--pagesize&nbsp;$(BOARD_KERNEL_PAGESIZE)&nbsp;&nbsp;</span></li><li class="alt"><span>endif&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>INSTALLED_BOOTIMAGE_TARGET&nbsp;:=&nbsp;$(PRODUCT_OUT)/boot.img&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>ifeq&nbsp;($(TARGET_BOOTIMAGE_USE_EXT2),true)&nbsp;&nbsp;</span></li><li class=""><span>tmp_dir_for_image&nbsp;:=&nbsp;$(call&nbsp;intermediates-dir-for,EXECUTABLES,boot_img)/bootimg&nbsp;&nbsp;</span></li><li class="alt"><span>INTERNAL_BOOTIMAGE_ARGS&nbsp;+=&nbsp;--tmpdir&nbsp;$(tmp_dir_for_image)&nbsp;&nbsp;</span></li><li class=""><span>INTERNAL_BOOTIMAGE_ARGS&nbsp;+=&nbsp;--genext2fs&nbsp;$(MKEXT2IMG)&nbsp;&nbsp;</span></li><li class="alt"><span>$(INSTALLED_BOOTIMAGE_TARGET):&nbsp;$(MKEXT2IMG)&nbsp;$(INTERNAL_BOOTIMAGE_FILES)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;pretty,"Target&nbsp;boot&nbsp;image:&nbsp;$@")&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(MKEXT2BOOTIMG)&nbsp;$(INTERNAL_BOOTIMAGE_ARGS)&nbsp;--output&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>else&nbsp;#&nbsp;TARGET_BOOTIMAGE_USE_EXT2&nbsp;!=&nbsp;true&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>$(INSTALLED_BOOTIMAGE_TARGET):&nbsp;$(MKBOOTIMG)&nbsp;$(INTERNAL_BOOTIMAGE_FILES)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;pretty,"Target&nbsp;boot&nbsp;image:&nbsp;$@")&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(MKBOOTIMG)&nbsp;$(INTERNAL_BOOTIMAGE_ARGS)&nbsp;$(BOARD_MKBOOTIMG_ARGS)&nbsp;--output&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(call&nbsp;assert-max-image-size,$@,$(BOARD_BOOTIMAGE_PARTITION_SIZE),raw)&nbsp;&nbsp;</span></li><li class="alt"><span>endif&nbsp;#&nbsp;TARGET_BOOTIMAGE_USE_EXT2&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>else&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;TARGET_NO_KERNEL&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;HACK:&nbsp;The&nbsp;top-level&nbsp;targets&nbsp;depend&nbsp;on&nbsp;the&nbsp;bootimage.&nbsp;&nbsp;Not&nbsp;all&nbsp;targets&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;can&nbsp;produce&nbsp;a&nbsp;bootimage,&nbsp;though,&nbsp;and&nbsp;emulator&nbsp;targets&nbsp;need&nbsp;the&nbsp;ramdisk&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;instead.&nbsp;&nbsp;Fake&nbsp;it&nbsp;out&nbsp;by&nbsp;calling&nbsp;the&nbsp;ramdisk&nbsp;the&nbsp;bootimage.&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;TODO:&nbsp;make&nbsp;the&nbsp;emulator&nbsp;use&nbsp;bootimages,&nbsp;and&nbsp;make&nbsp;mkbootimg&nbsp;accept&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kernel-less&nbsp;inputs.&nbsp;&nbsp;</span></li><li class="alt"><span>INSTALLED_BOOTIMAGE_TARGET&nbsp;:=&nbsp;$(INSTALLED_RAMDISK_TARGET)&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">ifneq ($(strip $(TARGET_NO_KERNEL)),true)

# -----------------------------------------------------------------
# the boot image, which is a collection of other images.
INTERNAL_BOOTIMAGE_ARGS := \
    $(addprefix --second ,$(INSTALLED_2NDBOOTLOADER_TARGET)) \
    --kernel $(INSTALLED_KERNEL_TARGET) \
    --ramdisk $(INSTALLED_RAMDISK_TARGET)

INTERNAL_BOOTIMAGE_FILES := $(filter-out --%,$(INTERNAL_BOOTIMAGE_ARGS))

BOARD_KERNEL_CMDLINE := $(strip $(BOARD_KERNEL_CMDLINE))
ifdef BOARD_KERNEL_CMDLINE
  INTERNAL_BOOTIMAGE_ARGS += --cmdline "$(BOARD_KERNEL_CMDLINE)"
endif

BOARD_KERNEL_BASE := $(strip $(BOARD_KERNEL_BASE))
ifdef BOARD_KERNEL_BASE
  INTERNAL_BOOTIMAGE_ARGS += --base $(BOARD_KERNEL_BASE)
endif

BOARD_KERNEL_PAGESIZE := $(strip $(BOARD_KERNEL_PAGESIZE))
ifdef BOARD_KERNEL_PAGESIZE
  INTERNAL_BOOTIMAGE_ARGS += --pagesize $(BOARD_KERNEL_PAGESIZE)
endif

INSTALLED_BOOTIMAGE_TARGET := $(PRODUCT_OUT)/boot.img

ifeq ($(TARGET_BOOTIMAGE_USE_EXT2),true)
tmp_dir_for_image := $(call intermediates-dir-for,EXECUTABLES,boot_img)/bootimg
INTERNAL_BOOTIMAGE_ARGS += --tmpdir $(tmp_dir_for_image)
INTERNAL_BOOTIMAGE_ARGS += --genext2fs $(MKEXT2IMG)
$(INSTALLED_BOOTIMAGE_TARGET): $(MKEXT2IMG) $(INTERNAL_BOOTIMAGE_FILES)
    $(call pretty,"Target boot image: $@")
    $(hide) $(MKEXT2BOOTIMG) $(INTERNAL_BOOTIMAGE_ARGS) --output $@

else # TARGET_BOOTIMAGE_USE_EXT2 != true

$(INSTALLED_BOOTIMAGE_TARGET): $(MKBOOTIMG) $(INTERNAL_BOOTIMAGE_FILES)
    $(call pretty,"Target boot image: $@")
    $(hide) $(MKBOOTIMG) $(INTERNAL_BOOTIMAGE_ARGS) $(BOARD_MKBOOTIMG_ARGS) --output $@
    $(hide) $(call assert-max-image-size,$@,$(BOARD_BOOTIMAGE_PARTITION_SIZE),raw)
endif # TARGET_BOOTIMAGE_USE_EXT2

else    # TARGET_NO_KERNEL
# HACK: The top-level targets depend on the bootimage.  Not all targets
# can produce a bootimage, though, and emulator targets need the ramdisk
# instead.  Fake it out by calling the ramdisk the bootimage.
# TODO: make the emulator use bootimages, and make mkbootimg accept
#       kernel-less inputs.
INSTALLED_BOOTIMAGE_TARGET := $(INSTALLED_RAMDISK_TARGET)
endif</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
在介绍boot.img之前，我们首先要介绍BootLoader。我们都知道，PC启动的时候，首先执行的是在BIOS上的代码，然后再由BIOS负责
将Kernel加载起来执行。在嵌入式世界里，BootLoader的作用就相当于PC的BIOS。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
BootLoader的启动通常分为两个阶段。第一阶段在固态存储中(Flash)执行，负责初始化硬件，例如设置CPU工作模式、时钟频率以及初始化内
存等，并且将第二阶段拷贝到RAM去准备执行。第二阶段就是在RAM中执行，因此速度会更快，主要负责建立内存映像，以及加载Kernel镜像和
Ramdisk镜像。<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
BootLoader的第二阶段执行完成后，就开始启动Kernel了。Kernel负责启动各个子系统，例如CPU调度子系统和内存管理子系统等等。
Kernel启动完成之后，就会将Ramdisk镜像安装为根系统，并且在其中找到一个init文件，将其启动为第一个进程。init进程启动就意味着系
统进入到用户空间执行了，这时候各种用户空间运行时以及守护进程就会被加载起来。最终完成整个系统的启动过程。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
BootLoader的第一阶段是固化在硬件中的，而boot.img的存在就是为BootLoader的第一阶段提供第二阶段、Kernel镜像、
Ramdisk镜像，以及相应的启动参数等等。也就是说，boot.img主要包含有BootLoader的第二阶段、Kernel镜像和Ramdisk
镜像。当然，BootLoader的第二阶段是可选的。当不存在BootLoader的第二阶段的时候，BootLoader的第一阶段启动完成后，就直
接进入到kernel启动阶段。</p><p>&nbsp; &nbsp; &nbsp;&nbsp; boot.img镜像的文件格式定义在system/core/mkbootimg/bootimg.h中，如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 12420px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_15" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_15" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=15&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>/*&nbsp;&nbsp;</span></span></li><li class=""><span>**&nbsp;+-----------------+&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;|&nbsp;boot&nbsp;header&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1&nbsp;page&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;+-----------------+&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;|&nbsp;kernel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;n&nbsp;pages&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;+-----------------+&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;|&nbsp;ramdisk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;m&nbsp;pages&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;+-----------------+&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;|&nbsp;second&nbsp;stage&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;o&nbsp;pages&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;+-----------------+&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;n&nbsp;=&nbsp;(kernel_size&nbsp;+&nbsp;page_size&nbsp;-&nbsp;1)&nbsp;/&nbsp;page_size&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;m&nbsp;=&nbsp;(ramdisk_size&nbsp;+&nbsp;page_size&nbsp;-&nbsp;1)&nbsp;/&nbsp;page_size&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;o&nbsp;=&nbsp;(second_size&nbsp;+&nbsp;page_size&nbsp;-&nbsp;1)&nbsp;/&nbsp;page_size&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;0.&nbsp;all&nbsp;entities&nbsp;are&nbsp;page_size&nbsp;aligned&nbsp;in&nbsp;flash&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;1.&nbsp;kernel&nbsp;and&nbsp;ramdisk&nbsp;are&nbsp;required&nbsp;(size&nbsp;!=&nbsp;0)&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;2.&nbsp;second&nbsp;is&nbsp;optional&nbsp;(second_size&nbsp;==&nbsp;0&nbsp;-&gt;&nbsp;no&nbsp;second)&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;3.&nbsp;load&nbsp;each&nbsp;element&nbsp;(kernel,&nbsp;ramdisk,&nbsp;second)&nbsp;at&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;specified&nbsp;physical&nbsp;address&nbsp;(kernel_addr,&nbsp;etc)&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;4.&nbsp;prepare&nbsp;tags&nbsp;at&nbsp;tag_addr.&nbsp;&nbsp;kernel_args[]&nbsp;is&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;&nbsp;&nbsp;&nbsp;appended&nbsp;to&nbsp;the&nbsp;kernel&nbsp;commandline&nbsp;in&nbsp;the&nbsp;tags.&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;5.&nbsp;r0&nbsp;=&nbsp;0,&nbsp;r1&nbsp;=&nbsp;MACHINE_TYPE,&nbsp;r2&nbsp;=&nbsp;tags_addr&nbsp;&nbsp;</span></li><li class=""><span>**&nbsp;6.&nbsp;if&nbsp;second_size&nbsp;!=&nbsp;0:&nbsp;jump&nbsp;to&nbsp;second_addr&nbsp;&nbsp;</span></li><li class="alt"><span>**&nbsp;&nbsp;&nbsp;&nbsp;else:&nbsp;jump&nbsp;to&nbsp;kernel_addr&nbsp;&nbsp;</span></li><li class=""><span>*/&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">/*
** +-----------------+ 
** | boot header     | 1 page
** +-----------------+
** | kernel          | n pages  
** +-----------------+
** | ramdisk         | m pages  
** +-----------------+
** | second stage    | o pages
** +-----------------+
**
** n = (kernel_size + page_size - 1) / page_size
** m = (ramdisk_size + page_size - 1) / page_size
** o = (second_size + page_size - 1) / page_size
**
** 0. all entities are page_size aligned in flash
** 1. kernel and ramdisk are required (size != 0)
** 2. second is optional (second_size == 0 -&gt; no second)
** 3. load each element (kernel, ramdisk, second) at
**    the specified physical address (kernel_addr, etc)
** 4. prepare tags at tag_addr.  kernel_args[] is
**    appended to the kernel commandline in the tags.
** 5. r0 = 0, r1 = MACHINE_TYPE, r2 = tags_addr
** 6. if second_size != 0: jump to second_addr
**    else: jump to kernel_addr
*/</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 它由4部分组成：boot 
header、kernel、ramdisk和second state。每一个部分的大小都是以页为单位的，其中，boot 
header描述了kernel、ramdisk、sencond stage的加载地址、大小，以及kernel启动参数等等信息。<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; boot header的结构同样是定义在system/core/mkbootimg/bootimg.h中，如下所示：</p><p></p><div class="dp-highlighter bg_cpp"><div class="bar"><div class="tools"><b>[cpp]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 820px; top: 13049px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_16" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_16" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=16&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol class="dp-cpp" start="1"><li class="alt"><span><span class="keyword">struct</span><span>&nbsp;boot_img_hdr&nbsp;&nbsp;</span></span></li><li class=""><span>{&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="datatypes">char</span><span>&nbsp;magic[BOOT_MAGIC_SIZE];&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;kernel_size;&nbsp;&nbsp;<span class="comment">/*&nbsp;size&nbsp;in&nbsp;bytes&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;kernel_addr;&nbsp;&nbsp;<span class="comment">/*&nbsp;physical&nbsp;load&nbsp;addr&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;ramdisk_size;&nbsp;<span class="comment">/*&nbsp;size&nbsp;in&nbsp;bytes&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;ramdisk_addr;&nbsp;<span class="comment">/*&nbsp;physical&nbsp;load&nbsp;addr&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;second_size;&nbsp;&nbsp;<span class="comment">/*&nbsp;size&nbsp;in&nbsp;bytes&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;second_addr;&nbsp;&nbsp;<span class="comment">/*&nbsp;physical&nbsp;load&nbsp;addr&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;tags_addr;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/*&nbsp;physical&nbsp;addr&nbsp;for&nbsp;kernel&nbsp;tags&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;page_size;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/*&nbsp;flash&nbsp;page&nbsp;size&nbsp;we&nbsp;assume&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;unused[2];&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">/*&nbsp;future&nbsp;expansion:&nbsp;should&nbsp;be&nbsp;0&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="datatypes">char</span><span>&nbsp;name[BOOT_NAME_SIZE];&nbsp;</span><span class="comment">/*&nbsp;asciiz&nbsp;product&nbsp;name&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="datatypes">char</span><span>&nbsp;cmdline[BOOT_ARGS_SIZE];&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;id[8];&nbsp;<span class="comment">/*&nbsp;timestamp&nbsp;/&nbsp;checksum&nbsp;/&nbsp;sha1&nbsp;/&nbsp;etc&nbsp;*/</span><span>&nbsp;&nbsp;</span></span></li><li class="alt"><span>};&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="cpp">struct boot_img_hdr
{
    unsigned char magic[BOOT_MAGIC_SIZE];

    unsigned kernel_size;  /* size in bytes */
    unsigned kernel_addr;  /* physical load addr */

    unsigned ramdisk_size; /* size in bytes */
    unsigned ramdisk_addr; /* physical load addr */

    unsigned second_size;  /* size in bytes */
    unsigned second_addr;  /* physical load addr */

    unsigned tags_addr;    /* physical addr for kernel tags */
    unsigned page_size;    /* flash page size we assume */
    unsigned unused[2];    /* future expansion: should be 0 */

    unsigned char name[BOOT_NAME_SIZE]; /* asciiz product name */

    unsigned char cmdline[BOOT_ARGS_SIZE];

    unsigned id[8]; /* timestamp / checksum / sha1 / etc */
};</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 各个成员变量的含义如下所示：<br><p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>magic</strong>：魔数，等于“ANDROID!”。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>kernel_size</strong>：Kernel大小，以字节为单位。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>kernel_addr</strong>：Kernel加载的物理地址。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>ramdisk_size</strong>：Ramdisk大小，以字节为单位。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>ramdisk_addr</strong>：Ramdisk加载的物理地址。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>second_size</strong>：BootLoader第二阶段的大小，以字节为单位。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>second_addr</strong>：BootLoader第二阶段加载的物理地址。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>tags_addr</strong>：Kernel启动之前，它所需要的启动参数都会填入到由tags_addr所描述的一个物理地址中去。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>unused</strong>：保留以后使用。<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>page_size</strong>：页大小。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>name</strong>：产品名称。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong> id</strong>：时间戳、校验码等等。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 理解了BootLoader的启动过程，以及boot.img的文件结构之后，就不难理解boot.img文件的生成过程了。<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
首先检查变量TARGET_NO_KERNEL的值是否等于true。如果等于true的话，那么就表示boot.img不包含有BootLoader第
二阶段和Kernel，即它等同于Ramdisk镜像。如果不等于true的话，那么就通过
INSTALLED_2NDBOOTLOADER_TARGET、INSTALLED_KERNEL_TARGET和
INSTALLED_RAMDISK_TARGET获得BootLoader第二阶段、Kernel和Ramdisk对应的镜像文件，以及通过
BOARD_KERNEL_CMDLINE、BOARD_KERNEL_BASE和BOARD_KERNEL_PAGESIZE获得Kernel启动命令
行参数、内核基地址和页大小等参数。最后根据TARGET_BOOTIMAGE_USE_EXT2的值来决定是使用genext2fs还是
mkbootimg工具来生成boot.img。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 三. ramdisk.img<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 从前面的分析可以知道，build/core/main.mk文件定义了ramdisk.img镜像文件的依赖规则，我们可以通过执行make 
ramdisk命令来执行。其中，ramdisk是一个伪目标，它依赖于INSTALLED_RAMDISK_TARGET。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSTALLED_RAMDISK_TARGET定义在build/core/Makefile文件中，如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 14420px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_17" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_17" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=17&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>INTERNAL_RAMDISK_FILES&nbsp;:=&nbsp;$(filter&nbsp;$(TARGET_ROOT_OUT)/%,&nbsp;\&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_PREBUILT)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_COPIED_HEADERS)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_GENERATED_SOURCES)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(ALL_DEFAULT_INSTALLED_MODULES))&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>BUILT_RAMDISK_TARGET&nbsp;:=&nbsp;$(PRODUCT_OUT)/ramdisk.img&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;We&nbsp;just&nbsp;build&nbsp;this&nbsp;directly&nbsp;to&nbsp;the&nbsp;install&nbsp;location.&nbsp;&nbsp;</span></li><li class=""><span>INSTALLED_RAMDISK_TARGET&nbsp;:=&nbsp;$(BUILT_RAMDISK_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>$(INSTALLED_RAMDISK_TARGET):&nbsp;$(MKBOOTFS)&nbsp;$(INTERNAL_RAMDISK_FILES)&nbsp;|&nbsp;$(MINIGZIP)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;pretty,"Target&nbsp;ram&nbsp;disk:&nbsp;$@")&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(MKBOOTFS)&nbsp;$(TARGET_ROOT_OUT)&nbsp;|&nbsp;$(MINIGZIP)&nbsp;&gt;&nbsp;$@&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">INTERNAL_RAMDISK_FILES := $(filter $(TARGET_ROOT_OUT)/%, \
    $(ALL_PREBUILT) \
    $(ALL_COPIED_HEADERS) \
    $(ALL_GENERATED_SOURCES) \
    $(ALL_DEFAULT_INSTALLED_MODULES))

BUILT_RAMDISK_TARGET := $(PRODUCT_OUT)/ramdisk.img

# We just build this directly to the install location.
INSTALLED_RAMDISK_TARGET := $(BUILT_RAMDISK_TARGET)
$(INSTALLED_RAMDISK_TARGET): $(MKBOOTFS) $(INTERNAL_RAMDISK_FILES) | $(MINIGZIP)
    $(call pretty,"Target ram disk: $@")
    $(hide) $(MKBOOTFS) $(TARGET_ROOT_OUT) | $(MINIGZIP) &gt; $@</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
ALL_PREBUILT、ALL_COPIED_HEADERS、ALL_GENERATED_SOURCES和
ALL_DEFAULT_INSTALLED_MODULES这几个变量的含义前面分析system.img的生成过程时已经介绍过了。因此，这里我们就
很容易知道，ramdisk.img镜像实际上就是由这几个变量所描述的、保存在TARGET_ROOT_OUT目录中的文件所组成。与此相对应的
是，system.img由保存在TARGET_OUT目录中的文件组成。</p><p>&nbsp; &nbsp; &nbsp; 
&nbsp;&nbsp;TARGET_ROOT_OUT和TARGET_OUT又分别是指向什么目录呢？假设我们的编译目标产品是模拟器，那么
TARGET_ROOT_OUT和TARGET_OUT对应的目录就分别为out/target/product/generic/root和out
/target/product/generic/system。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
收集好对应的文件之后，就可以通过MKBOOTFS和MINIGZIP这两个变量描述的mkbootfs和minigzip工具来生成一个格式为cpio
的ramdisk.img了。mkbootfs和minigzip这两个工具对应的源码分别位于system/core/cpio和external
/zlib目录中。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 四. userdata.img</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; userdata.img镜像描述的是Android系统的data分区，即/data目录，里面包含了用户安装的APP以及数据等等。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 从前面的分析可以知道，build/core/main.mk文件定义了userdata.img镜像文件的依赖规则，我们可以通过执行make 
userdataimage命令来执行。其中，userdataimage是一个伪目标，它依赖于
INSTALLED_USERDATAIMAGE_TARGET。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; INSTALLED_USERDATAIMAGE_TARGET定义在build/core/Makefile文件中，如下所示：</p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 15249px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_18" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_18" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=18&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>INTERNAL_USERDATAIMAGE_FILES&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(filter&nbsp;$(TARGET_OUT_DATA)/%,$(ALL_DEFAULT_INSTALLED_MODULES))&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>$(info&nbsp;$(TARGET_OUT_DATA))&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;If&nbsp;we&nbsp;build&nbsp;"tests"&nbsp;at&nbsp;the&nbsp;same&nbsp;time,&nbsp;make&nbsp;sure&nbsp;$(tests_MODULES)&nbsp;get&nbsp;covered.&nbsp;&nbsp;</span></li><li class="alt"><span>ifdef&nbsp;is_tests_build&nbsp;&nbsp;</span></li><li class=""><span>INTERNAL_USERDATAIMAGE_FILES&nbsp;+=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(filter&nbsp;$(TARGET_OUT_DATA)/%,$(tests_MODULES))&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>userdataimage_intermediates&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;intermediates-dir-for,PACKAGING,userdata)&nbsp;&nbsp;</span></li><li class=""><span>BUILT_USERDATAIMAGE_TARGET&nbsp;:=&nbsp;$(PRODUCT_OUT)/userdata.img&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>define&nbsp;build-userdataimage-target&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;$(call&nbsp;pretty,"Target&nbsp;userdata&nbsp;fs&nbsp;image:&nbsp;$(INSTALLED_USERDATAIMAGE_TARGET)")&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(TARGET_OUT_DATA)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(userdataimage_intermediates)&nbsp;&amp;&amp;&nbsp;rm&nbsp;-rf&nbsp;$(userdataimage_intermediates)/userdata_image_info.txt&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;$(call&nbsp;generate-userimage-prop-dictionary,&nbsp;$(userdataimage_intermediates)/userdata_image_info.txt)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;$(hide)&nbsp;PATH=$(foreach&nbsp;p,$(INTERNAL_USERIMAGES_BINARY_PATHS),$(p):)$$PATH&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./build/tools/releasetools/build_image.py&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(TARGET_OUT_DATA)&nbsp;$(userdataimage_intermediates)/userdata_image_info.txt&nbsp;$(INSTALLED_USERDATAIMAGE_TARGET)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;$(hide)&nbsp;$(call&nbsp;assert-max-image-size,$(INSTALLED_USERDATAIMAGE_TARGET),$(BOARD_USERDATAIMAGE_PARTITION_SIZE),yaffs)&nbsp;&nbsp;</span></li><li class="alt"><span>endef&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;We&nbsp;just&nbsp;build&nbsp;this&nbsp;directly&nbsp;to&nbsp;the&nbsp;install&nbsp;location.&nbsp;&nbsp;</span></li><li class=""><span>INSTALLED_USERDATAIMAGE_TARGET&nbsp;:=&nbsp;$(BUILT_USERDATAIMAGE_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>$(INSTALLED_USERDATAIMAGE_TARGET):&nbsp;$(INTERNAL_USERIMAGES_DEPS)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(INTERNAL_USERDATAIMAGE_FILES)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(build-userdataimage-target)&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">INTERNAL_USERDATAIMAGE_FILES := \
    $(filter $(TARGET_OUT_DATA)/%,$(ALL_DEFAULT_INSTALLED_MODULES))

$(info $(TARGET_OUT_DATA))

# If we build "tests" at the same time, make sure $(tests_MODULES) get covered.
ifdef is_tests_build
INTERNAL_USERDATAIMAGE_FILES += \
    $(filter $(TARGET_OUT_DATA)/%,$(tests_MODULES))
endif

userdataimage_intermediates := \
    $(call intermediates-dir-for,PACKAGING,userdata)
BUILT_USERDATAIMAGE_TARGET := $(PRODUCT_OUT)/userdata.img

define build-userdataimage-target
  $(call pretty,"Target userdata fs image: $(INSTALLED_USERDATAIMAGE_TARGET)")
  @mkdir -p $(TARGET_OUT_DATA)
  @mkdir -p $(userdataimage_intermediates) &amp;&amp; rm -rf $(userdataimage_intermediates)/userdata_image_info.txt
  $(call generate-userimage-prop-dictionary, $(userdataimage_intermediates)/userdata_image_info.txt)
  $(hide) PATH=$(foreach p,$(INTERNAL_USERIMAGES_BINARY_PATHS),$(p):)$$PATH \
      ./build/tools/releasetools/build_image.py \
      $(TARGET_OUT_DATA) $(userdataimage_intermediates)/userdata_image_info.txt $(INSTALLED_USERDATAIMAGE_TARGET)
  $(hide) $(call assert-max-image-size,$(INSTALLED_USERDATAIMAGE_TARGET),$(BOARD_USERDATAIMAGE_PARTITION_SIZE),yaffs)
endef

# We just build this directly to the install location.
INSTALLED_USERDATAIMAGE_TARGET := $(BUILT_USERDATAIMAGE_TARGET)
$(INSTALLED_USERDATAIMAGE_TARGET): $(INTERNAL_USERIMAGES_DEPS) \
                                   $(INTERNAL_USERDATAIMAGE_FILES)
    $(build-userdataimage-target)</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
INSTALLED_USERDATAIMAGE_TARGET的值等于BUILT_USERDATAIMAGE_TARGET，后者指向的就是
userdata.img文件，它依赖于INTERNAL_USERDATAIMAGE_FILES描述的文件，即那些由
ALL_DEFAULT_INSTALLED_MODULES描述的、并且位于TARGET_OUT_DATA目录下的文件。假设我们的编译目标产品是模
拟器，那么TARGET_OUT_DATA对应的目录就为out/target/product/generic/data。此外，如果我们在make 
userdataimage的时候，还带有一个额外的tests目标，那么那些将自己的tag设置为tests的模块也会被打包到
userdata.img镜像中。<br><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; 
INSTALLED_USERDATAIMAGE_TARGET还依赖于INTERNAL_USERIMAGES_DEPS。前面在分析
system.img镜像的生成过程时提到，INTERNAL_USERIMAGES_DEPS描述的是制作userdata.img镜像所依赖的工具。
例如，如果要制作的userdata.img使用的是yaffs2文件系统，那么对应工具就是mkyaffs2image。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
INSTALLED_USERDATAIMAGE_TARGET规则由函数build-userdataimage-target来执行，该函数通过
build_image.py脚本来生成userdata.img镜像文件。<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 与system.img镜像类似，userdata.img镜像的生成也可以通过一个没有任何依赖的伪目标userdataimage-nodeps生成，如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 16305px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_19" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_19" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=19&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>.PHONY:&nbsp;userdataimage-nodeps&nbsp;&nbsp;</span></span></li><li class=""><span>userdataimage-nodeps:&nbsp;|&nbsp;$(INTERNAL_USERIMAGES_DEPS)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(build-userdataimage-target)&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">.PHONY: userdataimage-nodeps
userdataimage-nodeps: | $(INTERNAL_USERIMAGES_DEPS)
    $(build-userdataimage-target)</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 当我们执行make 
userdataimage-nodeps的时候，函数build-userdataimage-target就会被调用直接生成
userdata.img文件。<p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 五. recovery.img<br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
recovery.img是设备进入recovery模式时所加载的镜像。recovery模式就是用来更新系统的，我们可以认为我们的设备具有两个系
统。一个是正常的系统，它由boot.img、system.img、ramdisk.img和userdata.img等组成，另外一个就是
recovery系统，由recovery.img组成。平时我们进入的都是正常的系统，只有当我们需要更新这个正常的系统时，才会进入到
recovery系统。因此，我们可以将recovery系统理解为在Linux 
Kernel之上运行的一个小小的用户空间运行时。这个用户空间运行时可以访问我们平时经常使用的那个系统的文件，从而实现对它的更新。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在build/core/Makefile文件中，定义了一个伪目标recoveryimage，用来生成recovery.img，如下所示：</p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 16704px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_20" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_20" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=20&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>.PHONY:&nbsp;recoveryimage&nbsp;&nbsp;</span></span></li><li class=""><span>recoveryimage:&nbsp;$(INSTALLED_RECOVERYIMAGE_TARGET)&nbsp;$(RECOVERY_RESOURCE_ZIP)&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">.PHONY: recoveryimage
recoveryimage: $(INSTALLED_RECOVERYIMAGE_TARGET) $(RECOVERY_RESOURCE_ZIP)</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
INSTALLED_RECOVERYIMAGE_TARGET描述的是组成recovery系统的模块文件，而
RECOVERY_RESOURCE_ZIP描述的是recovery系统使用的资源包，它的定义如下所示：<p></p><p></p><div class="dp-highlighter bg_plain"><div class="bar"><div class="tools"><b>[plain]</b> <a href="#" class="ViewSource" title="view plain" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" class="CopyToClipboard" title="copy" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy</a><a href="#" class="PrintSource" title="print" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" class="About" title="?" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a><div style="position: absolute; left: 827px; top: 16861px; width: 18px; height: 18px; z-index: 99;"><embed id="ZeroClipboardMovie_21" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_21" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=21&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18"></div></div></div><ol start="1"><li class="alt"><span><span>INSTALLED_RECOVERYIMAGE_TARGET&nbsp;:=&nbsp;$(PRODUCT_OUT)/recovery.img&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>recovery_initrc&nbsp;:=&nbsp;$(call&nbsp;include-path-for,&nbsp;recovery)/etc/init.rc&nbsp;&nbsp;</span></li><li class=""><span>recovery_kernel&nbsp;:=&nbsp;$(INSTALLED_KERNEL_TARGET)&nbsp;#&nbsp;same&nbsp;as&nbsp;a&nbsp;non-recovery&nbsp;system&nbsp;&nbsp;</span></li><li class="alt"><span>recovery_ramdisk&nbsp;:=&nbsp;$(PRODUCT_OUT)/ramdisk-recovery.img&nbsp;&nbsp;</span></li><li class=""><span>recovery_build_prop&nbsp;:=&nbsp;$(INSTALLED_BUILD_PROP_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>recovery_binary&nbsp;:=&nbsp;$(call&nbsp;intermediates-dir-for,EXECUTABLES,recovery)/recovery&nbsp;&nbsp;</span></li><li class=""><span>recovery_resources_common&nbsp;:=&nbsp;$(call&nbsp;include-path-for,&nbsp;recovery)/res&nbsp;&nbsp;</span></li><li class="alt"><span>recovery_resources_private&nbsp;:=&nbsp;$(strip&nbsp;$(wildcard&nbsp;$(TARGET_DEVICE_DIR)/recovery/res))&nbsp;&nbsp;</span></li><li class=""><span>recovery_resource_deps&nbsp;:=&nbsp;$(shell&nbsp;find&nbsp;$(recovery_resources_common)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;$(recovery_resources_private)&nbsp;-type&nbsp;f)&nbsp;&nbsp;</span></li><li class=""><span>recovery_fstab&nbsp;:=&nbsp;$(strip&nbsp;$(wildcard&nbsp;$(TARGET_DEVICE_DIR)/recovery.fstab))&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Named&nbsp;'.dat'&nbsp;so&nbsp;we&nbsp;don't&nbsp;attempt&nbsp;to&nbsp;use&nbsp;imgdiff&nbsp;for&nbsp;patching&nbsp;it.&nbsp;&nbsp;</span></li><li class=""><span>RECOVERY_RESOURCE_ZIP&nbsp;:=&nbsp;$(TARGET_OUT)/etc/recovery-resource.dat&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>......&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>INTERNAL_RECOVERYIMAGE_ARGS&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(addprefix&nbsp;--second&nbsp;,$(INSTALLED_2NDBOOTLOADER_TARGET))&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;--kernel&nbsp;$(recovery_kernel)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;--ramdisk&nbsp;$(recovery_ramdisk)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Assumes&nbsp;this&nbsp;has&nbsp;already&nbsp;been&nbsp;stripped&nbsp;&nbsp;</span></li><li class=""><span>ifdef&nbsp;BOARD_KERNEL_CMDLINE&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;INTERNAL_RECOVERYIMAGE_ARGS&nbsp;+=&nbsp;--cmdline&nbsp;"$(BOARD_KERNEL_CMDLINE)"&nbsp;&nbsp;</span></li><li class=""><span>endif&nbsp;&nbsp;</span></li><li class="alt"><span>ifdef&nbsp;BOARD_KERNEL_BASE&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;INTERNAL_RECOVERYIMAGE_ARGS&nbsp;+=&nbsp;--base&nbsp;$(BOARD_KERNEL_BASE)&nbsp;&nbsp;</span></li><li class="alt"><span>endif&nbsp;&nbsp;</span></li><li class=""><span>BOARD_KERNEL_PAGESIZE&nbsp;:=&nbsp;$(strip&nbsp;$(BOARD_KERNEL_PAGESIZE))&nbsp;&nbsp;</span></li><li class="alt"><span>ifdef&nbsp;BOARD_KERNEL_PAGESIZE&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;INTERNAL_RECOVERYIMAGE_ARGS&nbsp;+=&nbsp;--pagesize&nbsp;$(BOARD_KERNEL_PAGESIZE)&nbsp;&nbsp;</span></li><li class="alt"><span>endif&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;Keys&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;OTA&nbsp;packages&nbsp;this&nbsp;build&nbsp;will&nbsp;accept.&nbsp;&nbsp;The&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;build&nbsp;always&nbsp;uses&nbsp;dev-keys&nbsp;for&nbsp;this;&nbsp;release&nbsp;packaging&nbsp;tools&nbsp;will&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;substitute&nbsp;other&nbsp;keys&nbsp;for&nbsp;this&nbsp;one.&nbsp;&nbsp;</span></li><li class=""><span>OTA_PUBLIC_KEYS&nbsp;:=&nbsp;$(DEFAULT_SYSTEM_DEV_CERTIFICATE).x509.pem&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>#&nbsp;Generate&nbsp;a&nbsp;file&nbsp;containing&nbsp;the&nbsp;keys&nbsp;that&nbsp;will&nbsp;be&nbsp;read&nbsp;by&nbsp;the&nbsp;&nbsp;</span></li><li class="alt"><span>#&nbsp;recovery&nbsp;binary.&nbsp;&nbsp;</span></li><li class=""><span>RECOVERY_INSTALL_OTA_KEYS&nbsp;:=&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(call&nbsp;intermediates-dir-for,PACKAGING,ota_keys)/keys&nbsp;&nbsp;</span></li><li class=""><span>DUMPKEY_JAR&nbsp;:=&nbsp;$(HOST_OUT_JAVA_LIBRARIES)/dumpkey.jar&nbsp;&nbsp;</span></li><li class="alt"><span>$(RECOVERY_INSTALL_OTA_KEYS):&nbsp;PRIVATE_OTA_PUBLIC_KEYS&nbsp;:=&nbsp;$(OTA_PUBLIC_KEYS)&nbsp;&nbsp;</span></li><li class=""><span>$(RECOVERY_INSTALL_OTA_KEYS):&nbsp;extra_keys&nbsp;:=&nbsp;$(patsubst&nbsp;%,%.x509.pem,$(PRODUCT_EXTRA_RECOVERY_KEYS))&nbsp;&nbsp;</span></li><li class="alt"><span>$(RECOVERY_INSTALL_OTA_KEYS):&nbsp;$(OTA_PUBLIC_KEYS)&nbsp;$(DUMPKEY_JAR)&nbsp;$(extra_keys)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;"DumpPublicKey:&nbsp;$@&nbsp;&lt;=&nbsp;$(PRIVATE_OTA_PUBLIC_KEYS)&nbsp;$(extra_keys)"&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;@rm&nbsp;-rf&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;java&nbsp;-jar&nbsp;$(DUMPKEY_JAR)&nbsp;$(PRIVATE_OTA_PUBLIC_KEYS)&nbsp;$(extra_keys)&nbsp;&gt;&nbsp;$@&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>$(INSTALLED_RECOVERYIMAGE_TARGET):&nbsp;$(MKBOOTFS)&nbsp;$(MKBOOTIMG)&nbsp;$(MINIGZIP)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(INSTALLED_RAMDISK_TARGET)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(INSTALLED_BOOTIMAGE_TARGET)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(recovery_binary)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(recovery_initrc)&nbsp;$(recovery_kernel)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(INSTALLED_2NDBOOTLOADER_TARGET)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(recovery_build_prop)&nbsp;$(recovery_resource_deps)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(recovery_fstab)&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(RECOVERY_INSTALL_OTA_KEYS)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;-----&nbsp;Making&nbsp;recovery&nbsp;image&nbsp;------&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;rm&nbsp;-rf&nbsp;$(TARGET_RECOVERY_OUT)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;mkdir&nbsp;-p&nbsp;$(TARGET_RECOVERY_OUT)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;mkdir&nbsp;-p&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/etc&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/tmp&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;Copying&nbsp;baseline&nbsp;ramdisk...&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;cp&nbsp;-R&nbsp;$(TARGET_ROOT_OUT)&nbsp;$(TARGET_RECOVERY_OUT)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;Modifying&nbsp;ramdisk&nbsp;contents...&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;rm&nbsp;-f&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/init*.rc&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;cp&nbsp;-f&nbsp;$(recovery_initrc)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;-cp&nbsp;$(TARGET_ROOT_OUT)/init.recovery.*.rc&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;cp&nbsp;-f&nbsp;$(recovery_binary)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/sbin/&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;cp&nbsp;-rf&nbsp;$(recovery_resources_common)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(foreach&nbsp;item,$(recovery_resources_private),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp&nbsp;-rf&nbsp;$(item)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(foreach&nbsp;item,$(recovery_fstab),&nbsp;\&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp&nbsp;-f&nbsp;$(item)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/etc/recovery.fstab)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;cp&nbsp;$(RECOVERY_INSTALL_OTA_KEYS)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/res/keys&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;cat&nbsp;$(INSTALLED_DEFAULT_PROP_TARGET)&nbsp;$(recovery_build_prop)&nbsp;\&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/default.prop&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(MKBOOTFS)&nbsp;$(TARGET_RECOVERY_ROOT_OUT)&nbsp;|&nbsp;$(MINIGZIP)&nbsp;&gt;&nbsp;$(recovery_ramdisk)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(MKBOOTIMG)&nbsp;$(INTERNAL_RECOVERYIMAGE_ARGS)&nbsp;$(BOARD_MKBOOTIMG_ARGS)&nbsp;--output&nbsp;$@&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;$(call&nbsp;assert-max-image-size,$@,$(BOARD_RECOVERYIMAGE_PARTITION_SIZE),raw)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;@echo&nbsp;-----&nbsp;Made&nbsp;recovery&nbsp;image:&nbsp;$@&nbsp;--------&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>$(RECOVERY_RESOURCE_ZIP):&nbsp;$(INSTALLED_RECOVERYIMAGE_TARGET)&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;mkdir&nbsp;-p&nbsp;$(dir&nbsp;$@)&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;$(hide)&nbsp;find&nbsp;$(TARGET_RECOVERY_ROOT_OUT)/res&nbsp;-type&nbsp;f&nbsp;|&nbsp;sort&nbsp;|&nbsp;zip&nbsp;-0qrj&nbsp;$@&nbsp;-@&nbsp;&nbsp;</span></li></ol></div><pre style="display: none;" name="code" class="plain">INSTALLED_RECOVERYIMAGE_TARGET := $(PRODUCT_OUT)/recovery.img

recovery_initrc := $(call include-path-for, recovery)/etc/init.rc
recovery_kernel := $(INSTALLED_KERNEL_TARGET) # same as a non-recovery system
recovery_ramdisk := $(PRODUCT_OUT)/ramdisk-recovery.img
recovery_build_prop := $(INSTALLED_BUILD_PROP_TARGET)
recovery_binary := $(call intermediates-dir-for,EXECUTABLES,recovery)/recovery
recovery_resources_common := $(call include-path-for, recovery)/res
recovery_resources_private := $(strip $(wildcard $(TARGET_DEVICE_DIR)/recovery/res))
recovery_resource_deps := $(shell find $(recovery_resources_common) \
  $(recovery_resources_private) -type f)
recovery_fstab := $(strip $(wildcard $(TARGET_DEVICE_DIR)/recovery.fstab))
# Named '.dat' so we don't attempt to use imgdiff for patching it.
RECOVERY_RESOURCE_ZIP := $(TARGET_OUT)/etc/recovery-resource.dat

......

INTERNAL_RECOVERYIMAGE_ARGS := \
    $(addprefix --second ,$(INSTALLED_2NDBOOTLOADER_TARGET)) \
    --kernel $(recovery_kernel) \
    --ramdisk $(recovery_ramdisk)

# Assumes this has already been stripped
ifdef BOARD_KERNEL_CMDLINE
  INTERNAL_RECOVERYIMAGE_ARGS += --cmdline "$(BOARD_KERNEL_CMDLINE)"
endif
ifdef BOARD_KERNEL_BASE
  INTERNAL_RECOVERYIMAGE_ARGS += --base $(BOARD_KERNEL_BASE)
endif
BOARD_KERNEL_PAGESIZE := $(strip $(BOARD_KERNEL_PAGESIZE))
ifdef BOARD_KERNEL_PAGESIZE
  INTERNAL_RECOVERYIMAGE_ARGS += --pagesize $(BOARD_KERNEL_PAGESIZE)
endif

# Keys authorized to sign OTA packages this build will accept.  The
# build always uses dev-keys for this; release packaging tools will
# substitute other keys for this one.
OTA_PUBLIC_KEYS := $(DEFAULT_SYSTEM_DEV_CERTIFICATE).x509.pem

# Generate a file containing the keys that will be read by the
# recovery binary.
RECOVERY_INSTALL_OTA_KEYS := \
    $(call intermediates-dir-for,PACKAGING,ota_keys)/keys
DUMPKEY_JAR := $(HOST_OUT_JAVA_LIBRARIES)/dumpkey.jar
$(RECOVERY_INSTALL_OTA_KEYS): PRIVATE_OTA_PUBLIC_KEYS := $(OTA_PUBLIC_KEYS)
$(RECOVERY_INSTALL_OTA_KEYS): extra_keys := $(patsubst %,%.x509.pem,$(PRODUCT_EXTRA_RECOVERY_KEYS))
$(RECOVERY_INSTALL_OTA_KEYS): $(OTA_PUBLIC_KEYS) $(DUMPKEY_JAR) $(extra_keys)
    @echo "DumpPublicKey: $@ &lt;= $(PRIVATE_OTA_PUBLIC_KEYS) $(extra_keys)"
    @rm -rf $@
    @mkdir -p $(dir $@)
    java -jar $(DUMPKEY_JAR) $(PRIVATE_OTA_PUBLIC_KEYS) $(extra_keys) &gt; $@

$(INSTALLED_RECOVERYIMAGE_TARGET): $(MKBOOTFS) $(MKBOOTIMG) $(MINIGZIP) \
        $(INSTALLED_RAMDISK_TARGET) \
        $(INSTALLED_BOOTIMAGE_TARGET) \
        $(recovery_binary) \
        $(recovery_initrc) $(recovery_kernel) \
        $(INSTALLED_2NDBOOTLOADER_TARGET) \
        $(recovery_build_prop) $(recovery_resource_deps) \
        $(recovery_fstab) \
        $(RECOVERY_INSTALL_OTA_KEYS)
    @echo ----- Making recovery image ------
    $(hide) rm -rf $(TARGET_RECOVERY_OUT)
    $(hide) mkdir -p $(TARGET_RECOVERY_OUT)
    $(hide) mkdir -p $(TARGET_RECOVERY_ROOT_OUT)/etc $(TARGET_RECOVERY_ROOT_OUT)/tmp
    @echo Copying baseline ramdisk...
    $(hide) cp -R $(TARGET_ROOT_OUT) $(TARGET_RECOVERY_OUT)
    @echo Modifying ramdisk contents...
    $(hide) rm -f $(TARGET_RECOVERY_ROOT_OUT)/init*.rc
    $(hide) cp -f $(recovery_initrc) $(TARGET_RECOVERY_ROOT_OUT)/
    $(hide) -cp $(TARGET_ROOT_OUT)/init.recovery.*.rc $(TARGET_RECOVERY_ROOT_OUT)/
    $(hide) cp -f $(recovery_binary) $(TARGET_RECOVERY_ROOT_OUT)/sbin/
    $(hide) cp -rf $(recovery_resources_common) $(TARGET_RECOVERY_ROOT_OUT)/
    $(hide) $(foreach item,$(recovery_resources_private), \
      cp -rf $(item) $(TARGET_RECOVERY_ROOT_OUT)/)
    $(hide) $(foreach item,$(recovery_fstab), \
      cp -f $(item) $(TARGET_RECOVERY_ROOT_OUT)/etc/recovery.fstab)
    $(hide) cp $(RECOVERY_INSTALL_OTA_KEYS) $(TARGET_RECOVERY_ROOT_OUT)/res/keys
    $(hide) cat $(INSTALLED_DEFAULT_PROP_TARGET) $(recovery_build_prop) \
            &gt; $(TARGET_RECOVERY_ROOT_OUT)/default.prop
    $(hide) $(MKBOOTFS) $(TARGET_RECOVERY_ROOT_OUT) | $(MINIGZIP) &gt; $(recovery_ramdisk)
    $(hide) $(MKBOOTIMG) $(INTERNAL_RECOVERYIMAGE_ARGS) $(BOARD_MKBOOTIMG_ARGS) --output $@
    $(hide) $(call assert-max-image-size,$@,$(BOARD_RECOVERYIMAGE_PARTITION_SIZE),raw)
    @echo ----- Made recovery image: $@ --------

$(RECOVERY_RESOURCE_ZIP): $(INSTALLED_RECOVERYIMAGE_TARGET)
    $(hide) mkdir -p $(dir $@)
    $(hide) find $(TARGET_RECOVERY_ROOT_OUT)/res -type f | sort | zip -0qrj $@ -@</pre><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
由于recovery.img和boot.img都是用来启动系统的，因此，它们的内容是比较类似，例如都包含有Kernel及其启动参数、
Ramdisk，以及可选的BootLoader第二阶段。此外，recovery.img还包含有以下的主要内容：</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1. 用来设置系统属性的文件build.prop和default.prop；</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2. 进入recovery界面时用到的资源文件recovery_resources_common和recovery_resources_private；</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3. 描述进入recovery模式时要安装的文件系统脚本recovery.fstab；</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4. 在recovery模式执行OTA更新要用到的证书OTA_PUBLIC_KEYS；</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5. 负责升级系统的recovery程序，它的源代码位于bootable/recovery目录中。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
通过对比Android正常使用时的系统和进行升级时使用的Recovery系统，我们就可以对运行Linux系统的移动设备（或者说嵌入式设备）世界窥
一斑而知全豹，实际上我们只需要有一个BootLoader、一个Linux 
Kernel，以及一个Ramdisk，就可以将它们运行起来。Ramdisk属于用户空间的范畴，它里面主要包含了Linux 
Kernel启动完成时所要加载的根文件系统。这个根文件系统的作用就是为整个系统提供一个init程序，以便Linux 
Kernel可以将控制权从内核空间转移到用户空间。系统提供什么样的功能给用户使用主要取决于在用户空间层运行了哪些服务和守护进程。这些服务守护进程
都是直接或者间接地由init进程启动的。例如，对于recovery系统来说，它最主要提供的功能就是让用户升级系统，也就是它的主要用户空间服务就是
负责执行长级任务的recovery程序。又如，我们正常使用的Android系统，它的主要用户空间服务和守护进程都是由system.img镜像提供
的，此外，我们还可以通过userdata.img镜像来安装第三方应用来丰富手机的功能。因此，我们也可以说，init进程启动的服务决定了系统的功
能。当然 ，这些功能是建立是硬件的基础之上的。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 
至此，我们就分析完成Android系统的主要镜像文件system.img、boot.img、ramdisk.img、userdata.img和
recovery.img的制作过程了，希望通过这些镜像文件的制作过程以及它们的作用的介绍，使得小伙伴后对Android系统有更进一步的认识。同
时，我们也结束了对Android编译系统的学习了。重新学习请参考<a target="_blank" href="http://blog.csdn.net/luoshengyang/article/details/18466779">Android编译系统简要介绍和学习计划</a>一文。想了解更多Android相关技术，欢迎关注老罗的新浪微博：<a target="_blank" href="http://weibo.com/shengyangluo">http://weibo.com/shengyangluo</a>。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br></p><p></p><p></p>
</div>



<!-- Baidu Button BEGIN -->
<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare" style="float: right;">
<a href="#" title="分享到QQ空间" class="bds_qzone"></a>
<a href="#" title="分享到新浪微博" class="bds_tsina"></a>
<a href="#" title="分享到腾讯微博" class="bds_tqq"></a>
<a href="#" title="分享到人人网" class="bds_renren"></a>
<a href="#" title="分享到网易微博" class="bds_t163"></a>
<span class="bds_more">更多</span>
<a title="累计分享2次" href="#" class="shareCount">2</a>
</div>
<!-- Baidu Button END -->


<!--192.168.100.34-->
<ul class="article_next_prev">
            <li class="prev_article"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian']);location.href='/luoshengyang/article/details/19023609';">上一篇</span><a href="http://blog.csdn.net/luoshengyang/article/details/19023609" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian'])">Android源代码编译命令m/mm/mmm/make分析</a></li>
</ul>

<!-- Baidu Button BEGIN -->
<script src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/bds_s_v2.js" type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=1536434"></script>

<script type="text/javascript">
    document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
<!-- Baidu Button END -->

        <div id="digg" articleid="20501657">
            <dl id="btnDigg" class="digg digg_disable">
                <dt onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_ding'])">顶</dt>
                <dd>12</dd>
            </dl>
            <dl id="btnBury" class="digg digg_disable">
                <dt onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_cai'])">踩</dt>
                <dd>0</dd>
            </dl>
        </div>
</div>
      <dl class="blog-associat-tag">
        <dt>主题推荐</dt>
        <dd>
                <a href="http://www.csdn.net/tag/android" target="_blank" class="blog-tage-red">android</a> 
                <a href="http://www.csdn.net/tag/android%E5%BC%80%E5%8F%91" target="_blank" class="blog-tage-red">android开发</a> 
                <a href="http://www.csdn.net/tag/android%E5%BA%94%E7%94%A8" target="_blank" class="blog-tage-red">android应用</a> 
                <a href="http://www.csdn.net/tag/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8" target="_blank" class="blog-tage-red">第三方应用</a> 
                <a href="http://www.csdn.net/tag/%E6%96%B0%E6%B5%AA%E5%BE%AE%E5%8D%9A" target="_blank" class="blog-tage-red">新浪微博</a> 
        </dd>
    </dl> 
    <dl class="blog-ass-articl tracking-ad" data-mod="popu_17">
        <dt><span>博文推荐</span></dt>
            <dd>
                <a href="http://blog.csdn.net/w7822938/article/details/25254749" title="[自定义控件-1]改变基本控件的UI" target="_blank">[自定义控件-1]改变基本控件的UI</a></dd>
            <dd>
                <a href="http://blog.csdn.net/chenbw1/article/details/25250087" title="仿天猫安卓客户端Banner的Indicator" target="_blank">仿天猫安卓客户端Banner的Indic...</a></dd>
            <dd>
                <a href="http://blog.csdn.net/ptwh0608/article/details/25253763" title="Android 常用开源控件收集" target="_blank">Android 常用开源控件收集</a></dd>
            <dd>
                <a href="http://blog.csdn.net/androidstudio/article/details/25249607" title="android layouts" target="_blank">android layouts</a></dd>
            <dd>
                <a href="http://blog.csdn.net/shinpox/article/details/25251661" title="The source code of the Account class of the famous IM app" target="_blank">The source code of t...</a></dd>
            <dd>
                <a href="http://blog.csdn.net/fu222cs98/article/details/25250471" title="Android学习之——ScrollView和ListView嵌套，显示顶" target="_blank">Android学习之——ScrollVi...</a></dd>
            <dd>
                <a href="http://blog.csdn.net/q626779313/article/details/25249645" title="Android使用百度地图SDK实现定位功能" target="_blank">Android使用百度地图SDK实现定位...</a></dd>
            <dd>
                <a href="http://blog.csdn.net/fanflame4444/article/details/25249019" title="android Toasts" target="_blank">android Toasts</a></dd>
    </dl>

    <div id="ad_cen">
        <script type="text/javascript">            BAIDU_CLB_SLOT_ID = "117306";</script>
        <script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/o.js"></script><div id="BAIDU_DUP_wrapper_117306_0"></div><script charset="utf-8" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ecom"></script><script charset="utf-8" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/fixed7o.js"></script><script type="text/javascript"><!--
google_ad_client = "ca-pub-1076724771190722";
/* blog正文下方728x90 */
google_ad_slot = "4497271841";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/show_ads.js">
</script><ins style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;" frameborder="0" height="90" scrolling="no" width="728"></iframe></ins></ins>
    </div>
    <script type="text/javascript">
        //new Ad(4, 'ad_cen');
    </script>
<div id="comment_title" class="panel_head">
    查看评论<a name="comments"></a></div>
<div id="comment_list"><dl class="comment_item comment_topic" id="comment_item_3813101"><dt class="comment_head" floor="12">12楼 <span class="user"><a class="username" href="http://blog.csdn.net/u011864002" target="_blank">sharcrane</a> <span class="ptime">前天 21:08发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3813101" username="u011864002"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/u011864002" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_u011864002.gif" height="40" width="40"></a></dd><dd class="comment_body">确实不错，条理清晰，分析透彻。</dd></dl><dl class="comment_item comment_topic" id="comment_item_3788135"><dt class="comment_head" floor="11">11楼 <span class="user"><a class="username" href="http://blog.csdn.net/xxx823952375" target="_blank">star__xing</a> <span class="ptime">2014-04-29 13:15发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3788135" username="xxx823952375"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/xxx823952375" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_xxx823952375.gif" height="40" width="40"></a></dd><dd class="comment_body">很喜欢博主的文章，刚刚用豆约翰博客备份专家备份了您的全部博文。</dd></dl><dl class="comment_item comment_topic" id="comment_item_3742685"><dt class="comment_head" floor="10">10楼 <span class="user"><a class="username" href="http://blog.csdn.net/ap105638" target="_blank">4M小水管</a> <span class="ptime">2014-04-15 16:40发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3742685" username="ap105638"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/ap105638" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_ap105638.jpg" height="40" width="40"></a></dd><dd class="comment_body">到此一游。。。。</dd></dl><dl class="comment_item comment_topic" id="comment_item_3742629"><dt class="comment_head" floor="9">9楼 <span class="user"><a class="username" href="http://blog.csdn.net/han1202012" target="_blank">万境绝尘</a> <span class="ptime">2014-04-15 16:25发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3742629" username="han1202012"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/han1202012" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_han1202012.jpg" height="40" width="40"></a></dd><dd class="comment_body">大神啊 (⊙o⊙)哦</dd></dl><dl class="comment_item comment_topic" id="comment_item_3741825"><dt class="comment_head" floor="8">8楼 <span class="user"><a class="username" href="http://blog.csdn.net/soledadzz" target="_blank">soledadzz</a> <span class="ptime">2014-04-15 11:45发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3741825" username="soledadzz"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/soledadzz" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_soledadzz.jpg" height="40" width="40"></a></dd><dd class="comment_body">您的文章已被推荐到CSDN首页，感谢您的分享。</dd></dl><dl class="comment_item comment_topic" id="comment_item_3740873"><dt class="comment_head" floor="7">7楼 <span class="user"><a class="username" href="http://blog.csdn.net/u012486389" target="_blank">安卓缔造终结</a> <span class="ptime">2014-04-15 00:34发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3740873" username="u012486389"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/u012486389" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_u012486389.gif" height="40" width="40"></a></dd><dd class="comment_body">老罗出品，必属精品，申请加群1136189725</dd></dl><dl class="comment_item comment_topic" id="comment_item_3739597"><dt class="comment_head" floor="6">6楼 <span class="user"><a class="username" href="http://blog.csdn.net/guan506713512" target="_blank">guan506713512</a> <span class="ptime">2014-04-14 17:05发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3739597" username="guan506713512"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/guan506713512" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_guan506713512.jpg" height="40" width="40"></a></dd><dd class="comment_body">老罗，QQ群又加不进去了。。。<br>申请加群啊，我qq 506713512</dd></dl><dl class="comment_item comment_topic" id="comment_item_3738353"><dt class="comment_head" floor="5">5楼 <span class="user"><a class="username" href="http://blog.csdn.net/xiaolong662007" target="_blank">xiaolong662007</a> <span class="ptime">2014-04-14 10:16发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3738353" username="xiaolong662007"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/xiaolong662007" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_xiaolong662007.jpg" height="40" width="40"></a></dd><dd class="comment_body">支持， 第一时间阅读</dd></dl><dl class="comment_item comment_topic" id="comment_item_3738287"><dt class="comment_head" floor="4">4楼 <span class="user"><a class="username" href="http://blog.csdn.net/miniloveyu" target="_blank">miniloveyu</a> <span class="ptime">2014-04-14 09:57发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3738287" username="miniloveyu"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/miniloveyu" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_miniloveyu.gif" height="40" width="40"></a></dd><dd class="comment_body">前来膜拜，慢慢看</dd></dl><dl class="comment_item comment_topic" id="comment_item_3738257"><dt class="comment_head" floor="3">3楼 <span class="user"><a class="username" href="http://blog.csdn.net/ritterliu" target="_blank">Ritter_Liu</a> <span class="ptime">2014-04-14 09:47发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3738257" username="ritterliu"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/ritterliu" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_ritterliu.gif" height="40" width="40"></a></dd><dd class="comment_body">什么都不说了，唯有感谢与钦佩，以老罗的水平，为啥不加入Google开发Android啊？</dd></dl><dl class="comment_item comment_topic" id="comment_item_3738165"><dt class="comment_head" floor="2">2楼 <span class="user"><a class="username" href="http://blog.csdn.net/jltxgcy" target="_blank">jltxgcy</a> <span class="ptime">2014-04-14 09:19发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3738165" username="jltxgcy"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/jltxgcy" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_jltxgcy.jpg" height="40" width="40"></a></dd><dd class="comment_body">顶起。虽然现在还没有看，但等我看完你出的那边书，这里面所有剩下的博客，都要好好看看。估计那时候会有更多精彩的博客。</dd><dl class="comment_item comment_reply" id="comment_item_3738199"><dt class="comment_head" floor="2">Re: <span class="user"><a class="username" href="http://blog.csdn.net/brave2211" target="_blank">张纪刚</a> <span class="ptime">2014-04-14 09:30发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3738199" username="brave2211"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/brave2211" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_brave2211.jpg" height="40" width="40"></a></dd><dd class="comment_body">回复jltxgcy：老罗出品， 必读。</dd></dl></dl><dl class="comment_item comment_topic" id="comment_item_3738045"><dt class="comment_head" floor="1">1楼 <span class="user"><a class="username" href="http://blog.csdn.net/conceptcon" target="_blank">conceptcon</a> <span class="ptime">2014-04-14 08:18发表</span>  <a href="#reply" class="cmt_btn reply" title="回复">[回复]</a> <span class="comment_manage" style="display:none;" commentid="3738045" username="conceptcon"> <a href="#quote" class="cmt_btn quote" title="引用">[引用]</a> <a href="#report" class="cmt_btn report" title="举报">[举报]</a></span></span></dt><dd class="comment_userface"><a href="http://blog.csdn.net/conceptcon" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/3_conceptcon.jpg" height="40" width="40"></a></dd><dd class="comment_body">顶。。。。。。。。。。。</dd></dl><div class="clear"></div></div>
<div style="display: none;" id="comment_bar">
</div>
<div id="comment_form"><div class="guest_link">您还没有登录,请<a href="javascript:void(0);" onclick="javascript:csdn.showLogin(function (dat) {js_logined(dat.data.userName);});">[登录]</a>或<a href="http://passport.csdn.net/account/register?from=http%3A%2F%2Fblog.csdn.net%2Fluoshengyang%2Farticle%2Fdetails%2F20501657">[注册]</a></div></div>
<div class="announce">
    * 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a name="reply"></a><a name="quote"></a></div>
<script type="text/javascript">
    var fileName = '20501657';
    var commentscount = 13;
    var islock = false
</script>
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/comment.js"></script>
    <div id="ad_bot">
    <iframe src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ad.html" style="border-width: 0px; overflow: hidden; width: 746px; height: 170px;" id="ad_frm_0" frameborder="0" scrolling="no"></iframe></div>
    <script type="text/javascript">
    new Ad(5, 'ad_bot');
    </script>
<div id="report_dialog">
</div>

<div id="d-top" style="bottom:60px;">
      

       <a id="quick-reply" class="btn btn-top q-reply" title="快速回复" style="display:none;">
            <img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/blog-icon-reply.png" alt="快速回复">
        </a>    

    <a id="d-top-a" class="btn btn-top backtop" style="" title="返回顶部" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_huidaodingbu'])">         
         <img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/top.png" alt="TOP">
    </a>
</div>
<script type="text/javascript">
    $(function ()
    {
        if($("#comment_content").length>0)
        {
            $("#quick-reply").show();

            $("#quick-reply").click(function(){
                setEditorFocus();
            });
        }       
     
        var d_top = $('#d-top-a');
        document.onscroll = function ()
        {
            var scrTop = (document.body.scrollTop || document.documentElement.scrollTop);
            if (scrTop > 500)
            {
                d_top.show();
            } else
            {
                d_top.hide();
            }
        }
        $('#d-top-a').click(function ()
        {
            scrollTo(0, 0);
            this.blur();
            return false;
        });
    });
  
</script>
<style type="text/css">
    .tag_list
    {
        background: none repeat scroll 0 0 #FFFFFF;
        border: 1px solid #D7CBC1;
        color: #000000;
        font-size: 12px;
        line-height: 20px;
        list-style: none outside none;
        margin: 10px 2% 0 1%;
        padding: 1px;
    }
    .tag_list h5
    {
        background: none repeat scroll 0 0 #E0DBD3;
        color: #47381C;
        font-size: 12px;
        height: 24px;
        line-height: 24px;
        padding: 0 5px;
        margin: 0;
    }
    .tag_list h5 a
    {
        color: #47381C;
    }
    .classify
    {
        margin: 10px 0;
        padding: 4px 12px 8px;
    }
    .classify a
    {
        margin-right: 20px;
        white-space: nowrap;
    }
</style>
<div class="tag_list">
    <h5>
        <a href="http://www.csdn.net/tag/" target="_blank">核心技术类目</a></h5>
    <div class="classify">
<a title="全部主题" href="http://www.csdn.net/tag" target="_blank" onclick="LogClickCount(this,336);">全部主题</a>
<a title="Java" href="http://www.csdn.net/tag/Java" target="_blank" onclick="LogClickCount(this,336);">Java</a>
<a title="VPN" href="http://www.csdn.net/tag/vpn" target="_blank" onclick="LogClickCount(this,336);">VPN</a>
<a title="Android" href="http://www.csdn.net/tag/android" target="_blank" onclick="LogClickCount(this,336);">Android</a>
<a title="iOS" href="http://www.csdn.net/tag/ios" target="_blank" onclick="LogClickCount(this,336);">iOS</a>
<a title="ERP" href="http://www.csdn.net/tag/erp" target="_blank" onclick="LogClickCount(this,336);">ERP</a>
<a title="IE10" href="http://www.csdn.net/tag/ie10" target="_blank" onclick="LogClickCount(this,336);">IE10</a>
<a title="Eclipse" href="http://www.csdn.net/tag/eclipse" target="_blank" onclick="LogClickCount(this,336);">Eclipse</a>
<a title="CRM" href="http://www.csdn.net/tag/crm" target="_blank" onclick="LogClickCount(this,336);">CRM</a>
<a title="JavaScript" href="http://www.csdn.net/tag/javascript" target="_blank" onclick="LogClickCount(this,336);">JavaScript</a>
<a title="Ubuntu" href="http://www.csdn.net/tag/ubuntu" target="_blank" onclick="LogClickCount(this,336);">Ubuntu</a>
<a title="NFC" href="http://www.csdn.net/tag/nfc" target="_blank" onclick="LogClickCount(this,336);">NFC</a>
<a title="WAP" href="http://www.csdn.net/tag/wap" target="_blank" onclick="LogClickCount(this,336);">WAP</a>
<a title="jQuery" href="http://www.csdn.net/tag/jquery" target="_blank" onclick="LogClickCount(this,336);">jQuery</a>
<a title="数据库" href="http://www.csdn.net/tag/%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank" onclick="LogClickCount(this,336);">数据库</a>
<a title="BI" href="http://www.csdn.net/tag/bi" target="_blank" onclick="LogClickCount(this,336);">BI</a>
<a title="HTML5" href="http://www.csdn.net/tag/html5" target="_blank" onclick="LogClickCount(this,336);">HTML5</a>
<a title="Spring" href="http://www.csdn.net/tag/spring" target="_blank" onclick="LogClickCount(this,336);">Spring</a>
<a title="Apache" href="http://www.csdn.net/tag/apache" target="_blank" onclick="LogClickCount(this,336);">Apache</a>
<a title="Hadoop" href="http://www.csdn.net/tag/hadoop" target="_blank" onclick="LogClickCount(this,336);">Hadoop</a>
<a title=".NET" href="http://www.csdn.net/tag/.net" target="_blank" onclick="LogClickCount(this,336);">.NET</a>
<a title="API" href="http://www.csdn.net/tag/api" target="_blank" onclick="LogClickCount(this,336);">API</a>
<a title="HTML" href="http://www.csdn.net/tag/html" target="_blank" onclick="LogClickCount(this,336);">HTML</a>
<a title="SDK" href="http://www.csdn.net/tag/sdk" target="_blank" onclick="LogClickCount(this,336);">SDK</a>
<a title="IIS" href="http://www.csdn.net/tag/iis" target="_blank" onclick="LogClickCount(this,336);">IIS</a>
<a title="Fedora" href="http://www.csdn.net/tag/fedora" target="_blank" onclick="LogClickCount(this,336);">Fedora</a>
<a title="XML" href="http://www.csdn.net/tag/xml" target="_blank" onclick="LogClickCount(this,336);">XML</a>
<a title="LBS" href="http://www.csdn.net/tag/lbs" target="_blank" onclick="LogClickCount(this,336);">LBS</a>
<a title="Unity" href="http://www.csdn.net/tag/unity" target="_blank" onclick="LogClickCount(this,336);">Unity</a>
<a title="Splashtop" href="http://www.csdn.net/tag/splashtop" target="_blank" onclick="LogClickCount(this,336);">Splashtop</a>
<a title="UML" href="http://www.csdn.net/tag/uml" target="_blank" onclick="LogClickCount(this,336);">UML</a>
<a title="components" href="http://www.csdn.net/tag/components" target="_blank" onclick="LogClickCount(this,336);">components</a>
<a title="Windows Mobile" href="http://www.csdn.net/tag/windowsmobile" target="_blank" onclick="LogClickCount(this,336);">Windows Mobile</a>
<a title="Rails" href="http://www.csdn.net/tag/rails" target="_blank" onclick="LogClickCount(this,336);">Rails</a>
<a title="QEMU" href="http://www.csdn.net/tag/qemu" target="_blank" onclick="LogClickCount(this,336);">QEMU</a>
<a title="KDE" href="http://www.csdn.net/tag/kde" target="_blank" onclick="LogClickCount(this,336);">KDE</a>
<a title="Cassandra" href="http://www.csdn.net/tag/cassandra" target="_blank" onclick="LogClickCount(this,336);">Cassandra</a>
<a title="CloudStack" href="http://www.csdn.net/tag/cloudstack" target="_blank" onclick="LogClickCount(this,336);">CloudStack</a>
<a title="FTC" href="http://www.csdn.net/tag/ftc" target="_blank" onclick="LogClickCount(this,336);">FTC</a>
<a title="coremail" href="http://www.csdn.net/tag/coremail" target="_blank" onclick="LogClickCount(this,336);">coremail</a>
<a title="OPhone " href="http://www.csdn.net/tag/ophone" target="_blank" onclick="LogClickCount(this,336);">OPhone </a>
<a title="CouchBase" href="http://www.csdn.net/tag/couchbase" target="_blank" onclick="LogClickCount(this,336);">CouchBase</a>
<a title="云计算" href="http://www.csdn.net/tag/%E4%BA%91%E8%AE%A1%E7%AE%97" target="_blank" onclick="LogClickCount(this,336);">云计算</a>
<a title="iOS6" href="http://www.csdn.net/tag/iOS6" target="_blank" onclick="LogClickCount(this,336);">iOS6</a>
<a title="Rackspace " href="http://www.csdn.net/tag/rackspace" target="_blank" onclick="LogClickCount(this,336);">Rackspace </a>
<a title="Web App" href="http://www.csdn.net/tag/webapp" target="_blank" onclick="LogClickCount(this,336);">Web App</a>
<a title="SpringSide" href="http://www.csdn.net/tag/springside" target="_blank" onclick="LogClickCount(this,336);">SpringSide</a>
<a title="Maemo" href="http://www.csdn.net/tag/maemo" target="_blank" onclick="LogClickCount(this,336);">Maemo</a>
<a title="Compuware" href="http://www.csdn.net/tag/compuware" target="_blank" onclick="LogClickCount(this,336);">Compuware</a>
<a title="大数据" href="http://www.csdn.net/tag/%E5%A4%A7%E6%95%B0%E6%8D%AE" target="_blank" onclick="LogClickCount(this,336);">大数据</a>
<a title="aptech" href="http://www.csdn.net/tag/aptech" target="_blank" onclick="LogClickCount(this,336);">aptech</a>
<a title="Perl" href="http://www.csdn.net/tag/perl" target="_blank" onclick="LogClickCount(this,336);">Perl</a>
<a title="Tornado" href="http://www.csdn.net/tag/tornado" target="_blank" onclick="LogClickCount(this,336);">Tornado</a>
<a title="Ruby" href="http://www.csdn.net/tag/ruby" target="_blank" onclick="LogClickCount(this,336);">Ruby</a>
<a title="Hibernate" href="http://www.csdn.net/hibernate" target="_blank" onclick="LogClickCount(this,336);">Hibernate</a>
<a title="ThinkPHP" href="http://www.csdn.net/tag/thinkphp" target="_blank" onclick="LogClickCount(this,336);">ThinkPHP</a>
<a title="Spark" href="http://www.csdn.net/tag/spark" target="_blank" onclick="LogClickCount(this,336);">Spark</a>
<a title="HBase" href="http://www.csdn.net/tag/hbase" target="_blank" onclick="LogClickCount(this,336);">HBase</a>
<a title="Pure" href="http://www.csdn.net/tag/pure" target="_blank" onclick="LogClickCount(this,336);">Pure</a>
<a title="Solr" href="http://www.csdn.net/tag/solr" target="_blank" onclick="LogClickCount(this,336);">Solr</a>
<a title="Angular" href="http://www.csdn.net/tag/angular" target="_blank" onclick="LogClickCount(this,336);">Angular</a>
<a title="Cloud Foundry" href="http://www.csdn.net/tag/cloudfoundry" target="_blank" onclick="LogClickCount(this,336);">Cloud Foundry</a>
<a title="Redis" href="http://www.csdn.net/tag/redis" target="_blank" onclick="LogClickCount(this,336);">Redis</a>
<a title="Scala" href="http://www.csdn.net/tag/scala" target="_blank" onclick="LogClickCount(this,336);">Scala</a>
<a title="Django" href="http://www.csdn.net/tag/django" target="_blank" onclick="LogClickCount(this,336);">Django</a>
<a title="Bootstrap" href="http://www.csdn.net/tag/bootstrap" target="_blank" onclick="LogClickCount(this,336);">Bootstrap</a>
    </div>
</div>

                    <div class="clear">
                    </div>
                </div>
            </div>
            <div id="side">
    <div class="side">
<div id="panel_Profile" class="panel">
<ul class="panel_head"><span>个人资料</span></ul>
<ul class="panel_body profile">
<div id="blog_userface">
    <a href="http://my.csdn.net/Luoshengyang" target="_blank">
    <img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/1_luoshengyang.jpg" title="访问我的空间" style="max-width:90%">
    </a>
    <br>
    <span><a href="http://my.csdn.net/Luoshengyang" class="user_name" target="_blank">罗升阳</a></span>
</div>
<div class="interact">
<a href="javascript:void(0);" class="attent" id="span_add_follow" title="[加关注]" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_guanzhu'])"></a>
<a href="javascript:void(0);" class="letter" onclick="loginto(1)" title="[发私信]"></a>
</div>
<div id="blog_medal">
        <div class="ico_expert" title="CSDN认证专家"></div>
<div id="bms_box"><a href="http://medal.blog.csdn.net/allmedal.aspx" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/columnstar_s.gif" onmouseover="m_over_m(this,0)" onmouseout="m_out_m()" alt=""></a><a href="http://medal.blog.csdn.net/allmedal.aspx" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/holdon_s2.gif" onmouseover="m_over_m(this,1)" onmouseout="m_out_m()" alt=""></a><a href="http://medal.blog.csdn.net/allmedal.aspx" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/blogstar13_s.gif" onmouseover="m_over_m(this,2)" onmouseout="m_out_m()" alt=""></a></div></div>
<ul id="blog_rank">
    <li>访问：<span>3402114次</span></li>
    <li>积分：<span>16930分</span></li>
    <li>排名：<span>第132名</span></li>
</ul>
<ul id="blog_statistics">
    <li>原创：<span>101篇</span></li>
    <li>转载：<span>0篇</span></li>
    <li>译文：<span>0篇</span></li>
    <li>评论：<span>5336条</span></li>
</ul>
</ul>
</div>


<div id="custom_column_6567056" class="panel">
<ul class="panel_head"><span>博客公告</span></ul>
<ul class="panel_body">
<b><font color="red" size="2">本博客所有文章均为原创，欢迎交流，欢迎转载；转载请勿篡改内容，并且注明出处，禁止用于商业目的，谢谢！</font></b>
</ul>
</div><div id="custom_column_21664874" class="panel">
<ul class="panel_head"><span>图书信息</span></ul>
<ul class="panel_body">
<font color="red"><b>书名：</b></font>
<p>《Android系统源代码情景分析》</p>

<p><a href="http://wenku.it168.com/d_000574719.shtml" target="_blank">试读请点击</a></p>

<p><font color="red"><b>出版社：</b></font></p>
<p>电子工业出版社</p>

<p><font color="red"><b>网店：</b></font></p>

<p>1. <a href="http://product.dangdang.com/product.aspx?product_id=22884086" target="_blank">当当网（满100减20，满200减50）</a></p><p></p>

<p>2. <a href="http://book.360buy.com/11104739.html" target="_blank">京东网（满99减20）</a></p><p></p>

<p>3. <a href="http://www.amazon.cn/Android%E7%B3%BB%E7%BB%9F%E6%BA%90%E4%BB%A3%E7%A0%81%E6%83%85%E6%99%AF%E5%88%86%E6%9E%90-%E7%BD%97%E5%8D%87%E9%98%B3/dp/B009OLU8EE" target="_blank">亚马逊网（满100减20，满200减50）</a></p><p></p>

<p>4. <a href="http://product.china-pub.com/3684413" target="_blank">互动出版网</a></p><p></p>

<p>5. <a href="http://www.suning.com/emall/prd_10052_22001_-7_3435777_.html" target="_blank">苏宁易购网</a></p><p></p>

<p><a href="http://s.etao.com/search?spm=1002.8.1.1386.g76Rk3&amp;q=Android%CF%B5%CD%B3%D4%B4%B4%FA%C2%EB%C7%E9%BE%B0%B7%D6%CE%F6&amp;style=list&amp;initiative_id=etao_20121011&amp;pn=1&amp;sort=sale-desc" target="_blank">比一比谁更实惠</a></p>

<p><font color="red"><b>号外：</b></font></p>

<p>本书繁体版已经成功输出到台湾</p>

<p></p>
</ul>
</div><div id="custom_column_21603386" class="panel">
<ul class="panel_head"><span>联系方式</span></ul>
<ul class="panel_body">
<font color="red"><b>新浪微博：</b></font>
<p><a href="http://weibo.com/shengyangluo" target="_blank"><font color="red"><b>http://weibo.com/shengyangluo</b></font></a></p><p></p>

<font color="red"><b>QQ交流群：</b></font>
<p><b><font color="red">130112760</font></b>（1000人群，未满）</p>
<p><b><font color="red">248749286</font></b>（1000人群，已满）</p>
<p><b><font color="red">204155322</font></b>（500人群，已满）</p>
<p><b><font color="red">278558417</font></b>（500人群，已满）</p>
<p><b><font color="red">303165655</font></b>（500人群，已满）</p>
<p>PS：请勿同时加入多个群，一经发现，永久封号，谢谢！</p>
</ul>
</div><div id="panel_Category" class="panel">
    <ul class="panel_head"><span>博客专栏</span></ul>
    <ul class="panel_body" id="sp_column">
    <table cellpadding="0" cellspacing="0"><tbody><tr>
    <td style="padding:10px 10px 0 0;">
    <a href="http://blog.csdn.net/column/details/androidluo.html" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/20111107095438958.jpg" style="width:75px;height:75px;"></a>
    </td>
    <td style="padding:10px 0; vertical-align:top;">
    <a href="http://blog.csdn.net/column/details/androidluo.html" target="_blank">老罗的Android之旅</a>
    <p>文章：101篇</p>
    <span>阅读：3417333</span>
    </td>
    </tr></tbody></table>
    </ul>
</div><div id="hotarticls" class="panel">
<ul class="panel_head">
    <span>       
阅读排行    </span>
</ul>

<ul class="panel_body itemlist">
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6559955" title="在Ubuntu上下载、编译和安装Android最新源代码">在Ubuntu上下载、编译和安装Android最新源代码</a><span>(116410)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6618363" title="Android进程间通信（IPC）机制Binder简要介绍和学习计划">Android进程间通信（IPC）机制Binder简要介绍和学习计划</a><span>(103673)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/8923485" title="那两年炼就的Android内功修养">那两年炼就的Android内功修养</a><span>(88723)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6689748" title="Android应用程序启动过程源代码分析">Android应用程序启动过程源代码分析</a><span>(86759)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6568411" title="在Ubuntu上为Android系统编写Linux内核驱动程序">在Ubuntu上为Android系统编写Linux内核驱动程序</a><span>(82690)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6567257" title="Android硬件抽象层（HAL）概要介绍和学习计划">Android硬件抽象层（HAL）概要介绍和学习计划</a><span>(76838)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6564592" title="在Ubuntu上下载、编译和安装Android最新内核源代码（Linux Kernel）">在Ubuntu上下载、编译和安装Android最新内核源代码（Linux Kernel）</a><span>(70509)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6557518" title="Android学习启动篇">Android学习启动篇</a><span>(63318)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6566662" title="如何单独编译Android源代码中的模块">如何单独编译Android源代码中的模块</a><span>(62108)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6575988" title="在Ubuntu为Android硬件抽象层（HAL）模块编写JNI方法提供Java访问硬件服务接口">在Ubuntu为Android硬件抽象层（HAL）模块编写JNI方法提供Java访问硬件服务接口</a><span>(59432)</span>
</li>
</ul>
</div>
<div id="hotarticls2" class="panel">
<ul class="panel_head"><span>评论排行</span></ul>
<ul class="panel_body itemlist">
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6689748" title="Android应用程序启动过程源代码分析">Android应用程序启动过程源代码分析</a><span>(324)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6559955" title="在Ubuntu上下载、编译和安装Android最新源代码">在Ubuntu上下载、编译和安装Android最新源代码</a><span>(240)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/8116866" title="《Android系统源代码情景分析》一书勘误">《Android系统源代码情景分析》一书勘误</a><span>(214)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/8923485" title="那两年炼就的Android内功修养">那两年炼就的Android内功修养</a><span>(192)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6882903" title="Android应用程序键盘（Keyboard）消息处理机制分析">Android应用程序键盘（Keyboard）消息处理机制分析</a><span>(184)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6580267" title="在Ubuntu上为Android系统内置Java应用程序测试Application Frameworks层的硬件服务">在Ubuntu上为Android系统内置Java应用程序测试Application Frameworks层的硬件服务</a><span>(170)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/7409491" title="Android博客文章整理">Android博客文章整理</a><span>(167)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6568411" title="在Ubuntu上为Android系统编写Linux内核驱动程序">在Ubuntu上为Android系统编写Linux内核驱动程序</a><span>(155)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/8452527" title="2012年的Android之旅：梦想、学习、坚持、自信、淡定">2012年的Android之旅：梦想、学习、坚持、自信、淡定</a><span>(139)</span>
</li>
<li>
<a href="http://blog.csdn.net/luoshengyang/article/details/6564592" title="在Ubuntu上下载、编译和安装Android最新内核源代码（Linux Kernel）">在Ubuntu上下载、编译和安装Android最新内核源代码（Linux Kernel）</a><span>(136)</span>
</li>
</ul>
</div>
<div id="newcomments" class="panel">
<ul class="panel_head"><span>最新评论</span></ul>
<ul class="panel_body itemlist">
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/6575988#comments">在Ubuntu为Android硬件抽象层（HAL）模块编写JNI方法提供Java访问硬件服务接口</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/yangguangmeng" class="user_name">阳光梦</a>:
罗老师您好，我想在framework/xxxx/impl下面加一个函数去调用守护进程的app，然后在...
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/6557518#comments">Android学习启动篇</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/u014061684" class="user_name">坛主说我长得帅</a>:
很不错 看了很多老罗的视频
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/6559955#comments">在Ubuntu上下载、编译和安装Android最新源代码</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/a1006570862" class="user_name">地下室森林</a>:
下载源码弄了一个礼拜，让我很惆怅，不容易阿终于好了，前来打卡
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/8116866#comments">《Android系统源代码情景分析》一书勘误</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/Luoshengyang" class="user_name">罗升阳</a>:
@jltxgcy:已列出，非常感谢！
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/12957169#comments">《老罗的Android之旅》导读PPT</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/alhah" class="user_name">alhah</a>:
很喜欢博主的文章，刚刚用豆约翰博客备份专家备份了您的全部博文。
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/7691321#comments">Android系统的开机画面显示过程分析</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/like_it" class="user_name">like_it</a>:
很喜欢博主的文章，刚刚用豆约翰博客备份专家备份了您的全部博文。
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/8223770#comments">Android应用程序窗口（Activity）的窗口对象（Window）的创建过程分析</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/linyiteng1220" class="user_name">linyiteng1220</a>:
顶一个，感谢老罗的无私奉献！
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/6559955#comments">在Ubuntu上下载、编译和安装Android最新源代码</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/zh11hd" class="user_name">zh11hd</a>:
.看来遇到问题的童鞋还是挺多的。
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/8201936#comments">Android应用程序窗口（Activity）的运行上下文环境（Context）的创建过程分析</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/linyiteng1220" class="user_name">linyiteng1220</a>:
顶一个，感谢大牛的无私分享！
    </p>
    </li>
    <li>
    <a href="http://blog.csdn.net/Luoshengyang/article/details/6557518#comments">Android学习启动篇</a>
    <p style="margin:0px;"><a href="http://blog.csdn.net/zh11hd" class="user_name">zh11hd</a>:
.从这里开启Android之旅。
    </p>
    </li>
</ul>
</div>
    </div>
    <div class="clear">
    </div>
</div>

            <div class="clear">
            </div>
        </div>
        

<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/newblog.js"></script>
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/showblogmedal.js"></script>
<script type="text/javascript">
    document.write('<script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js?' + Math.floor(new Date() / 120000).toString(36) + '="></' + 'script>');
</script><script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/publib_footer.js"></script><link rel="stylesheet" type="text/css" href="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/pub_footer_2012.css"><div id="pub_footerall" class="pub_footerall"><dl><dt></dt> <dd><a href="http://www.csdn.net/company/about.html" target="_blank">公司简介</a>|<a href="http://www.csdn.net/company/recruit.html" target="_blank">招贤纳士</a>|<a href="http://www.csdn.net/company/marketing.html" target="_blank">广告服务</a>|<a href="http://www.csdn.net/company/account.html" target="_blank">银行汇款帐号</a>|<a href="http://www.csdn.net/company/contact.html" target="_blank">联系方式</a>|<a href="http://www.csdn.net/company/statement.html" target="_blank">版权声明</a>|<a href="http://www.csdn.net/company/layer.html" target="_blank">法律顾问</a>|<a href="mailto:webmaster@csdn.net">问题报告</a>|<a target="_blank" href="http://www.csdn.net/friendlink.html">合作伙伴</a>|<a href="http://bbs.csdn.net/forums/Service" target="_blank">论坛反馈</a></dd><dd><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2355263776&amp;site=qq&amp;menu=yes" target="_blank" class="qq">网站客服</a> <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2251809102&amp;site=qq&amp;menu=yes" target="_blank" class="qq">杂志客服</a> <a href="http://e.weibo.com/csdnsupport/profile" target="_blank" class="weibo">微博客服</a> <a href="mailto:webmaster@csdn.net" class="email" title="联系邮箱">webmaster@csdn.net</a> <span class="phone" title="服务热线">400-600-2320</span></dd><dd>京&nbsp;ICP&nbsp;证&nbsp;070598&nbsp;号</dd><dd>北京创新乐知信息技术有限公司 版权所有</dd><dd>江苏乐知网络技术有限公司 提供商务支持</dd><dd>Copyright © 1999-2014, CSDN.NET, All Rights Reserved&nbsp;<a href="http://www.hd315.gov.cn/beian/view.asp?bianhao=010202001032100010" target="_blank"><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/gongshang_logos.gif" alt="GongshangLogo" title=""></a></dd></dl></div><div id="note1" class="csdn_note" style="display:none; position:absolute; z-index:9999; width:440px">  <span class="notice_top_arrow"><span class="inner"></span></span>  <div class="box"></div></div><div class="csdn_notice_tip" style="display:none; position:absolute; z-index:9990; width:170px">  <iframe src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/a_002.html" style="z-index:-1;position:absolute;top:0;left:0;width:100%;height:100%;background:transparent" frameborder="0" scrolling="no"></iframe>  <div class="tip_text">您有<strong>0</strong>条新通知</div>  <a href="javascript:void%200" class="close2"></a></div><script id="noticeScript" type="text/javascript" btnid="header_notice_num" wrapid="note1" count="5" subcount="5" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/notify.js"></script>
    <script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/login.js"></script>
<script type="text/javascript">document.write("<img src=http://counter.csdn.net/pv.aspx?id=24 border=0 width=0 height=0>");</script><img src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/pv.asc" border="0" height="0" width="0">
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/counter.js"></script><script type="text/javascript" charset="UTF-8" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/msg.js"></script>
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ad-blog.js"></script><script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ad-ms763.js"></script>
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ad-ms771_2.js"></script>
<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/ad-ms762_3.js"></script>

<script type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/count.js"></script><iframe src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/logs.html" frameborder="0" height="0" width="0"></iframe>
<script type="text/javascript">
    $(function () {
        function __get_code_toolbar(snippet_id) {
            return $("<a href='https://code.csdn.net/snippets/"
                    + snippet_id
                    + "' target='_blank' title='在CODE上查看代码片' style='text-indent:0;'><img src='https://code.csdn.net/assets/CODE_ico.png' width=12 height=12 alt='在CODE上查看代码片' style='position:relative;top:1px;left:2px;'/></a>"
                    + "<a href='https://code.csdn.net/snippets/"
                    + snippet_id
                    + "/fork' target='_blank' title='派生到我的代码片'  style='text-indent:0;'><img src='https://code.csdn.net/assets/ico_fork.svg' width=12 height=12 alt='派生到我的代码片' style='position:relative;top:2px;left:2px;'/></a>");
        }
        
        $("[code_snippet_id]").each(function () {
            __s_id = $(this).attr("code_snippet_id");
            if (__s_id != null && __s_id != "" && __s_id != 0 && parseInt(__s_id) > 70020) {
                __code_tool = __get_code_toolbar(__s_id);
                $(this).prev().find(".tools").append(__code_tool);
            }
        });
    });
</script>

    </div>
      <!--new top-->
    
    <script id="csdn-toolbar-id" btnid="header_notice_num" wrapid="note1" count="5" subcount="5" type="text/javascript" src="Android%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%9A%84%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%20%E5%8D%9A%E5%AE%A2%E9%A2%91%E9%81%93%20-%20CSDN.NET_files/toolbar.js"></script>
     <!--new top-->


</body></html>